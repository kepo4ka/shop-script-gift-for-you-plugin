import{d as x,o,c as u,a as l,r as M,j as k,b as $,w as v,F as V,q as ee,i as P,n as z,e as U,p as g,h as D,M as ke,a3 as fe,a4 as ge,a9 as _e,H as rt,ax as G,t as de,ag as ct,aT as We,l as N,u as E,A as I,s as te,x as se,_ as X,aq as be,aD as dt,I as we,O as ut,k as J,b0 as ht,b9 as pt,m as Xe,ba as vt,at as Ee,V as mt,bb as ft,ao as $e,aj as gt,af as bt,bc as yt,Z as ve,v as He,bd as kt,be as _t,R as Ce,aW as wt,aR as Me,ak as Et,aE as je,bf as $t,B as Ke,aO as Ct,N as St,al as Re,aQ as Pt,aA as Bt}from"./main-f4d713e0.js";import{U as K}from"./UserPic-6f399f83.js";import{M as ue,_ as le,D as Ze}from"./DropDown-a7251113.js";import{a as Ne,b as Dt,c as Je}from"./emit-2e4d7646.js";import{u as Ge}from"./dealStageChanger-850da92f.js";import{D as Tt}from"./DropDownButton-3208b591.js";import{_ as xt}from"./DropdownAddTags.vue_vue_type_script_setup_true_lang-edbf97b0.js";import{c as Se,d as Ot}from"./index-00848a90.js";import{_ as It}from"./TagsCloud.vue_vue_type_script_setup_true_lang-1a57c5fb.js";import{C as ie}from"./CustomColumn-97fca79e.js";import{C as Ft,f as Ht}from"./fields-9557e3ab.js";import{I as re}from"./IconButton-ac0bf9c2.js";import{v as ye}from"./vTooltip-95186f83.js";import{C as Mt,T as Rt}from"./CustomField-8fd1f62c.js";import{v as Nt,a as At}from"./index-c6546edf.js";import{_ as Qe,b as et,a as tt,c as Vt,u as Lt}from"./InputWithPerformers.vue_vue_type_script_setup_true_lang-99fd8abe.js";import{B as he}from"./ButtonSubmit-3daf0653.js";import{d as Ae}from"./dayjs-72e0aed2.js";import{d as Yt}from"./date-adb8c64a.js";import{i as zt}from"./currency-format-e3b07f87.js";import{v as qt}from"./FieldCheckbox-24639e50.js";import{D as Ut}from"./DropdownModal-c1344324.js";import{u as Wt}from"./dealFields-af2473cb.js";import{_ as Xt}from"./TabContentIframe.vue_vue_type_script_setup_true_lang-817d6496.js";import{S as jt}from"./SkeletonList-bb6bf037.js";import{E as Kt}from"./EmptyList-3026908b.js";import{u as Zt}from"./validation-d43747e8.js";const Jt={class:"dropdown-header-item"},Gt={class:"dropdown-header-item__header"},Qt={class:"dropdown-header-item__title"},es=l("i",{class:"fas fa-times"},null,-1),ts=[es],ss=["onClick"],is={class:"icon small"},ns={key:0,class:"icon"},as=l("i",{class:"fas fa-check !tw-text-sm"},null,-1),os=[as],ls={key:1,class:"icon"},rs=l("i",{class:"fas fa-spinner wa-animation-spin"},null,-1),cs=[rs],Ve=x({__name:"DropdownStagesBody",props:{stages:{},fetchStageId:{},iconClose:{type:Boolean}},emits:["clickStage","close"],setup(r,{emit:e}){const t=r;return(s,i)=>(o(),u("div",null,[l("div",Jt,[l("div",Gt,[l("span",Qt,[M(s.$slots,"default")]),t.iconClose?(o(),u("span",{key:0,class:"dropdown-header-item__btn",onClick:i[0]||(i[0]=n=>e("close"))},ts)):k("",!0)])]),$(ue,null,{default:v(()=>[(o(!0),u(V,null,ee(t.stages,n=>(o(),P(le,{key:n.id,selected:n.selected},{default:v(()=>[l("a",{class:z({"tw-opacity-50":n.lighten}),onClick:U(a=>e("clickStage",n.id),["prevent"])},[l("div",is,[$(K,{size:10,"disable-rounded":"","bg-color":n.color},null,8,["bg-color"])]),l("span",null,g(n.name),1),!t.fetchStageId&&n.selected?(o(),u("span",ns,os)):k("",!0),t.fetchStageId===n.id?(o(),u("span",ls,cs)):k("",!0)],10,ss)]),_:2},1032,["selected"]))),128))]),_:1})]))}}),ds=x({__name:"DropDownWithAuxBody",props:{openAuxBody:{type:Boolean}},setup(r){const e=r,t=D(!1);return ke(()=>{t.value=!!e.openAuxBody}),(s,i)=>(o(),P(Ze,null,{default:v(n=>[M(s.$slots,"default",fe(ge(n)))]),body:v(n=>[M(s.$slots,"body",fe(ge(n)))]),auxBody:v(({parentProps:n})=>[t.value?(o(),u("div",{key:0,class:"dropdown-body !tw-top-0 mobile:!tw-left-0",style:_e({width:n.width,"max-height":n.maxHeight,left:`calc(${n.width} + 5px)`})},[M(s.$slots,"aux-body",{hide:()=>t.value=!1})],4)):k("",!0)]),_:3}))}}),ne=r=>(te("data-v-bb2c6b6d"),r=r(),se(),r),us={key:1,class:"icon size-12 tw-flex",style:{color:"var(--deal-color-gray-primary)"}},hs=ne(()=>l("i",{class:"fas fa-info-circle"},null,-1)),ps=[hs],vs={class:"tw-flex tw-items-center"},ms=["title"],fs={key:0,class:"gray tw-ml-1 small"},gs={class:"dropdown-header-item tw-py-1"},bs={class:"dropdown-header-item__header"},ys={class:"dropdown-header-item__title"},ks={key:0,class:"gray"},_s=ne(()=>l("i",{class:"fas fa-pen"},null,-1)),ws=[_s],Es=["title"],$s=ne(()=>l("hr",{class:"tw-mb-0"},null,-1)),Cs=ne(()=>l("hr",{class:"tw-mb-0"},null,-1)),Ss=["onClick"],Ps={key:0,class:"icon"},Bs=ne(()=>l("i",{class:"fas fa-spinner wa-animation-spin"},null,-1)),Ds=[Bs],Ts={key:1,class:"icon small"},xs=["onClick"],Os={class:"icon small"},Is={class:"dropdown-header-item !tw-mt-1.5"},Fs={class:"dropdown-header-item__header"},Hs={class:"dropdown-header-item__title tw-uppercase tw-font-semibold"},Ms=["onClick"],Rs=ne(()=>l("i",{class:"fas fa-times"},null,-1)),Ns=[Rs],As=["onClick"],Vs={class:"icon small"},Ls={key:0,class:"icon"},Ys=ne(()=>l("i",{class:"fas fa-check !tw-text-sm"},null,-1)),zs=[Ys],qs=x({__name:"DropdownStages",setup(r){const{t:e}=rt(),t=G(),{deal:s}=de(t),i=ct(),{funnels:n,isFinished:a}=de(i);i.fetch();const c=Ge(s),p=D("stages"),d=D(),h=D(),f=D(!1),b=D(!1),m=We({openStageId:null,funnelId:null});ke(()=>{var B;d.value=i.getFunnelById((B=s.value)==null?void 0:B.funnel_id)});const C=N(()=>{var B;return((B=s.value)==null?void 0:B.status_id)!=="OPEN"}),_=N(()=>{var B;if(d.value&&((B=d.value.stages)!=null&&B.length)){let R=!0;return d.value.stages.map(L=>{var W;const O=!C.value&&((W=s.value)==null?void 0:W.stage_id)===L.id;return R&&(R=!O),{...L,selected:O,lighten:R}})}return[]}),y=N(()=>{var R,L,O,W;const B=(R=s.value)==null?void 0:R.status_id;return(L=d.value)!=null&&L.stages?B==="OPEN"?d.value.stages.find(Q=>{var ae;return Q.id===((ae=s.value)==null?void 0:ae.stage_id)}):B==="WON"?{id:"won",name:e("won"),color:(O=d.value)==null?void 0:O.color}:B==="LOST"?{id:"lost",name:e("lost"),color:(W=d.value)==null?void 0:W.color}:null:null});function T(){p.value="stages",h.value=void 0}function S(){f.value=!0,b.value=!1,T()}function w(B){h.value=B,b.value=f.value=!0}async function Y(B,R){var W,Q,ae,Be,De,Te,xe,Oe;if(C.value||((W=y.value)==null?void 0:W.id)===B)return;m.openStageId=B;const L=(Q=s.value)==null?void 0:Q.stage_id,{response:O}=await c.changeOpenStage({funnel_id:R||((ae=d.value)==null?void 0:ae.id),stage_id:B});if(m.openStageId=null,(Be=O.value)!=null&&Be.ok&&!R){const Ie=((De=n.value.find(ce=>{var Fe;return ce.id===((Fe=d.value)==null?void 0:Fe.id)}))==null?void 0:De.stages)??[],ot=((Te=Ie.find(ce=>ce.id===L))==null?void 0:Te.number)??0,lt=((xe=Ie.find(ce=>ce.id===B))==null?void 0:xe.number)??0;ot<lt&&Ne()}return(Oe=O.value)==null?void 0:Oe.ok}async function F(B){!d.value||C.value||(m.funnelId=d.value.id,await c.closeDeal(B),m.funnelId=null,B==="WON"&&Ne())}async function H(B){var R;(R=h.value)!=null&&R.id&&await Y(B,h.value.id)&&(d.value={...h.value},b.value=f.value=!1,T())}return(B,R)=>(o(),P(ds,{"use-mobile":"",width:"222px",disabled:C.value,open:f.value,"open-aux-body":b.value},{default:v(()=>[$(Tt,{"is-skeleton":!E(a)||!E(s),disabled:C.value,"color-class":"blank",class:"tw-h-[32px]",rounded:"",onClick:R[0]||(R[0]=U(L=>d.value?null:p.value="funnels",["prevent"]))},{icon:v(()=>{var L,O;return[y.value?(o(),u(V,{key:0},[C.value?(o(),P(K,{key:"stage_"+y.value.id,size:16,"fa-icon":((L=y.value)==null?void 0:L.id)==="won"?"flag-checkered":"ban","icon-color":y.value.color,"disable-rounded":!0},null,8,["fa-icon","icon-color"])):(o(),P(K,{key:y.value.id,size:16,"icon-color":y.value.color,"icon-class":(O=d.value)==null?void 0:O.icon,"disable-rounded":!0},null,8,["icon-color","icon-class"]))],64)):E(a)?(o(),u("span",us,ps)):k("",!0)]}),default:v(()=>{var L;return[l("span",vs,[l("span",{class:"tw-truncate",title:d.value?y.value?y.value.name:B.$t("stageDeleted"):B.$t("funnelDeleted")},g(d.value?y.value?y.value.name:B.$t("stageDeleted"):B.$t("funnelDeleted")),9,ms),(L=d.value)!=null&&L.is_archived?(o(),u("span",fs,g(B.$t("archived")),1)):k("",!0)])]}),_:1},8,["is-skeleton","disabled"])]),body:v(({hide:L})=>[E(s)?(o(),u(V,{key:0},[p.value==="stages"&&d.value?(o(),u(V,{key:0},[l("div",gs,[l("div",bs,[l("span",ys,[I(g(B.$t("funnel"))+" ",1),d.value.is_archived?(o(),u("span",ks,g(B.$t("archived")),1)):k("",!0)]),l("span",{class:"dropdown-header-item__btn",onClick:R[1]||(R[1]=U(O=>p.value="funnels",["prevent"]))},ws)]),l("span",{class:"dropdown-header-item__name",title:d.value.name},g(d.value.name),9,Es)]),$s,$(Ve,{stages:_.value,"fetch-stage-id":m.openStageId,onClickStage:O=>Y(O).then(L)},{default:v(()=>[I(g(B.$t("changeStage")),1)]),_:2},1032,["stages","fetch-stage-id","onClickStage"]),Cs,$(ue,{class:"inline-items deal-stage-closed"},{default:v(()=>[$(le,{selected:E(s).status_id==="WON"},{default:v(()=>[l("a",{class:"inline-item",onClick:U(O=>F("WON").then(L),["prevent"])},[m.funnelId===d.value.id?(o(),u("div",Ps,Ds)):(o(),u("div",Ts,[$(K,{size:14,"fa-icon":"flag-checkered","icon-color":d.value.color},null,8,["icon-color"])])),l("span",null,g(B.$t("won")),1)],8,Ss)]),_:2},1032,["selected"]),$(le,{selected:E(s).status_id==="LOST"},{default:v(()=>[l("a",{class:"inline-item",onClick:U(O=>F("LOST").then(L),["prevent"])},[l("div",Os,[$(K,{size:14,"fa-icon":"ban","icon-color":d.value.color},null,8,["icon-color"])]),l("span",null,g(B.$t("lost")),1)],8,xs)]),_:2},1032,["selected"])]),_:2},1024)],64)):k("",!0),p.value==="funnels"?(o(),u(V,{key:1},[l("div",Is,[l("div",Fs,[l("span",Hs,g(B.$t("editFunnel")),1),l("span",{class:"dropdown-header-item__btn",onClick:U(S,["prevent"])},Ns,8,Ms)])]),$(ue,null,{default:v(()=>[(o(!0),u(V,null,ee(E(n).filter(O=>!O.is_archived),O=>{var W;return o(),P(le,{key:O.id,selected:((W=h.value)==null?void 0:W.id)===O.id},{default:v(()=>{var Q;return[l("a",{onClick:U(ae=>w(O),["prevent"])},[l("div",Vs,[$(K,{size:10,"icon-class":O.icon,"icon-color":O.color},null,8,["icon-class","icon-color"])]),l("span",null,g(O.name),1),((Q=d.value)==null?void 0:Q.id)===O.id?(o(),u("span",Ls,zs)):k("",!0)],8,As)]}),_:2},1032,["selected"])}),128))]),_:1})],64)):k("",!0)],64)):k("",!0)]),"aux-body":v(()=>{var L,O,W;return[$(Ve,{stages:((L=h.value)==null?void 0:L.id)===((O=d.value)==null?void 0:O.id)?_.value:((W=h.value)==null?void 0:W.stages)||[],"fetch-stage-id":m.openStageId,"icon-close":!0,onClose:R[2]||(R[2]=Q=>{b.value=!1,h.value=void 0}),onClickStage:H},{default:v(()=>[I(g(B.$t("selectStage")),1)]),_:1},8,["stages","fetch-stage-id"])]}),_:1},8,["disabled","open","open-aux-body"]))}});const Ao=X(qs,[["__scopeId","data-v-bb2c6b6d"]]),Le=x({__name:"DropdownAddTags",props:{dealIds:{}},setup(r){const e=r,{deal:t}=de(G());return(s,i)=>E(t)?(o(),P(xt,{key:0,modelValue:E(t),"onUpdate:modelValue":i[0]||(i[0]=n=>be(t)?t.value=n:null),"entity-type":"deal","entity-ids":e.dealIds},null,8,["modelValue","entity-ids"])):k("",!0)}}),Us={class:"gray small"},Ws=l("i",{class:"fas fa-plus"},null,-1),Xs={class:"gray small"},js=l("i",{class:"fas fa-plus"},null,-1),Ks={class:"tw-p-2"},Zs=x({__name:"DealInfoTags",props:{modelValue:{},dealId:{}},setup(r){const e=r,t=dt(e,"modelValue"),s=we(Se);async function i(n){var c;const{response:a}=await ut("crm.tag.remove").post({deal_id:[e.dealId],tag:[n]});(c=a.value)!=null&&c.ok&&(t.value=t.value.filter(p=>p.name!==n))}return(n,a)=>(o(),P(ie,{space:"none"},{default:v(()=>[$(It,{"entity-type":"deal",tags:E(t),editable:!0,onDeleteTag:i},null,8,["tags"]),E(s)?(o(),P(Ft,{key:0,"color-caret":"gray"},{name:v(()=>[l("div",Us,[Ws,I(" "+g(n.$t("addTag")),1)])]),default:v(()=>[$(Le,{"deal-ids":[e.dealId]},null,8,["deal-ids"])]),_:1})):(o(),P(Ze,{key:1},{body:v(()=>[l("div",Ks,[$(Le,{"deal-ids":[e.dealId]},null,8,["deal-ids"])])]),default:v(()=>[l("a",Xs,[js,I(" "+g(n.$t("addTag")),1)])]),_:1}))]),_:1}))}}),Js=r=>(te("data-v-7148ecaa"),r=r(),se(),r),Gs=Js(()=>l("span",{class:"skeleton-line"},null,-1)),Qs=[Gs],ei={key:1,class:"field"},ti={key:0,class:"field__heading"},si=x({__name:"DealInfoSection",props:{type:{},value:{},label:{},skeleton:{type:Boolean},skeletonWidth:{},class:{},useAdd:{type:Boolean},space:{}},emits:["add"],setup(r,{emit:e}){const t=r;return(s,i)=>t.skeleton?(o(),u("div",{key:0,class:"skeleton",style:_e(`width: ${t.skeletonWidth||100}%`)},Qs,4)):(o(),u("div",ei,[l("div",{class:z(["field__header",`tw-mb-${t.space||1}`])},[t.label?(o(),u("div",ti,g(t.label),1)):k("",!0),t.useAdd?(o(),P(re,{key:1,class:"field__edit-btn","icon-color":"var(--deal-sidebar-icon-color)",icon:"plus",onClick:i[0]||(i[0]=n=>e("add"))},{default:v(()=>[I(g(s.$t("add")),1)]),_:1})):M(s.$slots,"buttonAdd",{key:2},void 0,!0)],2),l("div",{class:z(["value",t.class,t.type||""])},[t.value?(o(),u(V,{key:0},[I(g(t.value),1)],64)):M(s.$slots,"default",{key:1},void 0,!0)],2)]))}});const oe=X(si,[["__scopeId","data-v-7148ecaa"]]),ii=x({__name:"DealInfoBadgeLabel",props:{label:{default:null},color:{default:"gray"}},setup(r){const e=r,t=D(),s=N(()=>t.value&&ht(t.value));return(i,n)=>e.label?(o(),u("span",{key:0,class:z(["badge nowrap",e.color])},[J((o(),u("span",{ref_key:"labelRef",ref:t,class:"tw-truncate"},[I(g(e.label),1)])),[[E(ye),s.value?e.label:null,void 0,{updated:!0}]])],2)):k("",!0)}});const Ye=X(ii,[["__scopeId","data-v-148d901f"]]),ni=r=>(te("data-v-c9e28add"),r=r(),se(),r),ai={class:"contactItem"},oi={key:0,class:"contactEdit"},li={key:1,class:"contactView"},ri={class:"tw-flex tw-justify-between tw-gap-x-1"},ci={class:"tw-flex tw-gap-x-2"},di={class:"contactNameWrapper"},ui=["href","onClick"],hi={class:"-tw-mt-1"},pi={key:0,class:"contactLabel"},vi={key:0},mi={key:1},fi={key:1,class:"contactCompanyJob"},gi=ni(()=>l("div",{class:"contactIcon icon"},[l("i",{class:"fas fa-briefcase"})],-1)),bi={key:2},yi={class:"contactConnect"},ki=x({__name:"DealInfoParticipantView",props:{contact:{},isResponsible:{type:Boolean}},setup(r){const e=r,t=D(!1),i=pt(vt).smallerOrEqual("sm");return(n,a)=>{var p,d,h;const c=Xe("RouterLink");return o(),u("div",ai,[t.value?(o(),u("div",oi,[M(n.$slots,"edit",{hide:()=>t.value=!1,participant:e.contact,isResponsible:e.isResponsible},void 0,!0)])):k("",!0),!t.value||E(i)?(o(),u("div",li,[l("div",ri,[l("div",ci,[$(K,{size:20,url:e.contact.contact.userpic},null,8,["url"]),l("div",di,[$(c,{to:{name:"contact",params:{id:e.contact.contact.id}},custom:""},{default:v(({navigate:f,href:b})=>[l("a",{class:z(["contactName break-words",n.$constant.parentAppDisableRouterClass]),href:b,onClick:m=>{n.$route.meta.menuItemType!=="frame"&&(E(Dt)(),f(m))}},g(e.contact.contact.name),11,ui)]),_:1},8,["to"]),e.isResponsible?(o(),P(Ye,{key:0,label:n.$t("responsible"),color:"orange"},null,8,["label"])):k("",!0),(p=e.contact.label)!=null&&p.trim()?(o(),P(Ye,{key:1,label:e.contact.label},null,8,["label"])):k("",!0)])]),l("div",hi,[$(re,{icon:"pen","icon-color":"var(--deal-sidebar-icon-color)",onClick:a[0]||(a[0]=U(f=>t.value=!0,["prevent"]))})])]),"counters"in e.contact?(o(),u(V,{key:0},["counters"in e.contact?(o(),u("div",pi,[(d=e.contact.counters)!=null&&d.shop_order?(o(),u("span",vi,g(e.contact.counters.shop_order)+". ",1)):k("",!0),(h=e.contact.counters)!=null&&h.deal?(o(),u("span",mi,g(e.contact.counters.deal),1)):k("",!0)])):k("",!0),e.contact.contact.company?(o(),u("div",fi,[gi,l("div",null,[e.contact.contact.jobtitle?(o(),u(V,{key:0},[I(g(e.contact.contact.jobtitle+" "),1)],64)):k("",!0),I(" "+g(n.$t("in")+" ")+" ",1),e.contact.contact.company_contact_id?(o(),P(c,{key:1,class:z(["contactName",n.$constant.parentAppDisableRouterClass]),to:{name:"contact",params:{id:e.contact.contact.company_contact_id}}},{default:v(()=>[I(g(e.contact.contact.company),1)]),_:1},8,["class","to"])):(o(),u("span",bi,g(e.contact.contact.company),1))])])):k("",!0),l("div",yi,[(o(!0),u(V,null,ee(new Array("email","phone","address"),f=>(o(),u(V,null,[(o(!0),u(V,null,ee(e.contact.contact[f],(b,m)=>(o(),P(Mt,{key:m,value:b,type:f,"contact-id":e.contact.contact.id,class:"tw-text-sm tw-mt-2"},null,8,["value","type","contact-id"]))),128))],64))),256))])],64)):k("",!0)])):k("",!0)])}}});const _i=X(ki,[["__scopeId","data-v-c9e28add"]]),wi={class:"state-with-inner-icon width-100 left"},Ei={key:0,class:"icon size-20 !tw-left-2"},$i={key:1,class:"icon text-gray"},Ci=l("i",{class:"fas fa-search"},null,-1),Si=[Ci],Pi=["value"],Bi=x({__name:"InputWithUser",props:{user:{}},setup(r){const e=r;return(t,s)=>(o(),u("div",wi,[t.user.userpic?(o(),u("div",Ei,[$(K,{url:t.user.userpic,size:20},null,8,["url"])])):(o(),u("div",$i,Si)),l("input",Ee({value:e.user.name,type:"text",class:"tw-w-full"},t.$attrs),null,16,Pi)]))}});function q(r,e,t,s){return new(t||(t=Promise))(function(i,n){function a(d){try{p(s.next(d))}catch(h){n(h)}}function c(d){try{p(s.throw(d))}catch(h){n(h)}}function p(d){var h;d.done?i(d.value):(h=d.value,h instanceof t?h:new t(function(f){f(h)})).then(a,c)}p((s=s.apply(r,e||[])).next())})}class j{static get touch(){return window.Modernizr&&window.Modernizr.touch===!0||!!(window.navigator.maxTouchPoints>0||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch)}static get observer(){return"MutationObserver"in window||"WebkitMutationObserver"in window}static get backdropFilter(){return CSS.supports("backdrop-filter","blur(0px)")||CSS.supports("-webkit-backdrop-filter","blur(0px)")}static get passiveListener(){let e=!1;try{const t=Object.defineProperty({},"passive",{get(){e=!0}});window.addEventListener("testPassiveListener",null,t)}catch{}return e}static get gestures(){return"ongesturestart"in window}}class Di{constructor(){this.ios=!1,this.android=!1,this.androidChrome=!1,this.desktop=!1,this.iphone=!1,this.ipod=!1,this.ipad=!1,this.edge=!1,this.ie=!1,this.firefox=!1,this.macos=!1,this.windows=!1,this.cordova=!(!window.cordova&&!window.phonegap),this.phonegap=!(!window.cordova&&!window.phonegap),this.electron=!1,this.ionic=!!document.querySelector("ion-app");const e=window.navigator.platform,t=window.navigator.userAgent,s=window.screen.width,i=window.screen.height;let n=t.match(/(Android);?[\s\/]+([\d.]+)?/),a=t.match(/(iPad).*OS\s([\d_]+)/),c=t.match(/(iPod)(.*OS\s([\d_]+))?/),p=!this.ipad&&t.match(/(iPhone\sOS|iOS)\s([\d_]+)/),d=t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0,h=t.indexOf("Edge/")>=0,f=t.indexOf("Gecko/")>=0&&t.indexOf("Firefox/")>=0,b=e==="Win32",m=t.toLowerCase().indexOf("electron")>=0,C=e==="MacIntel";!a&&C&&j.touch&&(s===1024&&i===1366||s===834&&i===1194||s===834&&i===1112||s===768&&i===1024)&&(a=t.match(/(Version)\/([\d.]+)/),C=!1),this.ie=d,this.edge=h,this.firefox=f,n&&!b&&(this.os="android",this.osVersion=n[2],this.android=!0,this.androidChrome=t.toLowerCase().indexOf("chrome")>=0),(a||p||c)&&(this.os="ios",this.ios=!0),p&&!c&&(this.osVersion=p[2].replace(/_/g,"."),this.iphone=!0),a&&(this.osVersion=a[2].replace(/_/g,"."),this.ipad=!0),c&&(this.osVersion=c[3]?c[3].replace(/_/g,"."):null,this.ipod=!0),this.ios&&this.osVersion&&t.indexOf("Version/")>=0&&this.osVersion.split(".")[0]==="10"&&(this.osVersion=t.toLowerCase().split("version/")[1].split(" ")[0]),this.webView=!(!(p||a||c)||!t.match(/.*AppleWebKit(?!.*Safari)/i)&&!window.navigator.standalone)||window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches,this.webview=this.webView,this.standalone=this.webView,this.desktop=!(this.ios||this.android)||m,this.desktop&&(this.electron=m,this.macos=C,this.windows=b,this.macos&&(this.os="macos"),this.windows&&(this.os="windows")),this.pixelRatio=window.devicePixelRatio||1}}class Ti{constructor(e){this.instance=e,this.allowClick=!0,this.disableDragAngle=!1,this.mouseDown=!1,this.contentScrollTop=0,this.steps=[],this.isScrolling=!1,this.touchStartCb=t=>this.touchStart(t),this.touchMoveCb=t=>this.touchMove(t),this.touchEndCb=t=>this.touchEnd(t),this.onScrollCb=t=>this.onScroll(t),this.onClickCb=t=>this.onClick(t),this.settings=this.instance.settings,this.device=this.instance.device,this.breakpoints=this.instance.breakpoints,this.transitions=this.instance.transitions,this.keyboardEvents=this.instance.keyboardEvents,this.touchEvents=this.getTouchEvents(),this.swipeNextSensivity=window.hasOwnProperty("cordova")?this.settings.fastSwipeSensivity+2:this.settings.fastSwipeSensivity}getTouchEvents(){const e=["touchstart","touchmove","touchend","touchcancel"];let t=["mousedown","mousemove","mouseup","mouseleave"];const s={start:e[0],move:e[1],end:e[2],cancel:e[3]},i={start:t[0],move:t[1],end:t[2],cancel:t[3]};return j.touch||!this.settings.simulateTouch?s:i}attachAllEvents(){this.settings.dragBy?this.settings.dragBy.forEach(e=>{const t=document.querySelector(e);t&&this.eventListeners("addEventListener",t)}):this.eventListeners("addEventListener",this.instance.paneEl),this.settings.topperOverflow&&this.instance.overflowEl.addEventListener("scroll",this.onScrollCb),this.settings.handleKeyboard&&this.device.cordova&&(window.addEventListener("keyboardWillShow",this.keyboardEvents.onKeyboardShowCb),window.addEventListener("keyboardWillHide",this.keyboardEvents.onKeyboardWillHideCb)),this.device.ionic&&this.device.android&&document.querySelectorAll(".ion-page").forEach(e=>{e.addEventListener("scroll",t=>{e.scrollTop&&e.scrollTo({top:0})})}),window.addEventListener("resize",this.keyboardEvents.onWindowResizeCb)}detachAllEvents(){this.settings.dragBy?this.settings.dragBy.forEach(e=>{const t=document.querySelector(e);t&&this.eventListeners("removeEventListener",t)}):this.eventListeners("removeEventListener",this.instance.paneEl),this.settings.topperOverflow&&this.instance.overflowEl.removeEventListener("scroll",this.onScrollCb),this.settings.handleKeyboard&&this.device.cordova&&(window.removeEventListener("keyboardWillShow",this.keyboardEvents.onKeyboardShowCb),window.removeEventListener("keyboardWillHide",this.keyboardEvents.onKeyboardWillHideCb)),window.removeEventListener("resize",this.keyboardEvents.onWindowResizeCb)}resetEvents(){this.detachAllEvents(),this.attachAllEvents()}eventListeners(e,t){if(j.touch){const s=!(this.touchEvents.start!=="touchstart"||!j.passiveListener||!this.settings.passiveListeners)&&{passive:!0,capture:!1};t[e](this.touchEvents.start,this.touchStartCb,s),t[e](this.touchEvents.move,this.touchMoveCb,!!j.passiveListener&&{passive:!1,capture:!1}),t[e](this.touchEvents.end,this.touchEndCb,s),t[e](this.touchEvents.cancel,this.touchEndCb,s)}else t[e](this.touchEvents.start,this.touchStartCb,!1),t[e](this.touchEvents.move,this.touchMoveCb,!1),t[e](this.touchEvents.end,this.touchEndCb,!1),t[e](this.touchEvents.cancel,this.touchEndCb,!1);this.settings.preventClicks&&t[e]("click",this.onClickCb,!0)}touchStart(e){if(this.instance.emit("onDragStart",e),this.allowClick=!0,this.instance.disableDragEvents)return;this.disableDragAngle=!1,this.isScrolling=!1,this.instance.preventedDismiss=!1;const{clientY:t,clientX:s}=this.getEventClientYX(e,"touchstart");t&&s&&(this.startY=t,this.startX=s,e.type==="mousedown"&&(this.mouseDown=!0),this.contentScrollTop&&this.willScrolled()&&!this.isDraggableElement(e)&&(this.startY+=this.contentScrollTop),this.steps.push({posY:this.startY,posX:this.startX,time:Date.now()}))}touchMove(e){var t;const{clientY:s,clientX:i,velocityY:n}=this.getEventClientYX(e,"touchmove");if(!s||!i||e.type==="mousemove"&&!this.mouseDown||(this.steps.length||this.steps.push({posY:s,posX:i,time:Date.now()}),e.delta=((t=this.steps[0])===null||t===void 0?void 0:t.posY)-s,this.allowClick=!1,this.isFormElement(e.target)&&this.isElementScrollable(e.target)))return;if(this.instance.disableDragEvents)return void(this.steps=[]);if(this.disableDragAngle||this.instance.preventedDismiss)return;this.settings.touchMoveStopPropagation&&e.stopPropagation();const a=s-this.steps[this.steps.length-1].posY,c=i-this.steps[this.steps.length-1].posX;if(!Math.abs(a)&&!Math.abs(c))return;this.instance.emit("onDrag",e),this.instance.setGrabCursor(!0,!0);let p=this.instance.getPanelTransformY()+a,d=this.instance.getPanelTransformX()+c;if(this.steps.length<2){n<1&&(p=this.instance.getPanelTransformY()+a*n);let f=new WebKitCSSMatrix(window.getComputedStyle(this.instance.paneEl).transform).m42-this.instance.getPanelTransformY();Math.abs(f)&&(p+=f)}if(this.steps.length>2&&this.isFormElement(document.activeElement)&&!this.isFormElement(e.target)&&(document.activeElement.blur(),this.keyboardEvents.inputBluredbyMove=!0),this.settings.touchAngle&&!this.isScrolling){let f;const b=i-this.startX,m=s-this.startY;if(f=180*Math.atan2(Math.abs(m),Math.abs(b))/Math.PI,b*b+m*m>=25&&90-f>this.settings.touchAngle&&this.steps.length===1)return void(this.disableDragAngle=!0)}if(this.instance.overflowEl.style.overflowY==="auto"&&this.scrollPreventDrag(e)&&!this.isDraggableElement(e))return;let h=this.handleSuperposition({clientX:i,clientY:s,newVal:p,newValX:d,diffY:a,diffX:c});if(h&&(isNaN(h.y)||(p=h.y),isNaN(h.x)||(d=h.x)),h!==!1&&(this.instance.getPanelTransformY()!==p||this.instance.getPanelTransformX()!==d)){if(!this.instance.preventedDismiss&&this.instance.preventDismissEvent&&this.settings.bottomClose){let f=(-this.breakpoints.topper+this.breakpoints.topper-this.instance.getPanelTransformY())/this.breakpoints.topper/-8;if(p=this.instance.getPanelTransformY()+a*(.5-f),-1*(s-220-this.instance.screen_height)<=this.instance.screen_height-this.breakpoints.bottomer)return this.instance.preventedDismiss=!0,this.instance.emit("onWillDismiss",{prevented:!0}),void this.instance.moveToBreak(this.breakpoints.prevBreakpoint)}this.instance.checkOpacityAttr(p),this.instance.checkOverflowAttr(p),this.transitions.doTransition({type:"move",translateY:p,translateX:d}),this.steps.push({posY:s,posX:i,time:Date.now()})}}touchEnd(e){var t,s;if(this.instance.disableDragEvents||e.type==="mouseleave"&&!this.mouseDown)return;e.type!=="mouseup"&&e.type!=="mouseleave"||(this.mouseDown=!1);let i,n=this.breakpoints.getClosestBreakY();this.fastSwipeNext("Y")&&(n=this.instance.swipeNextPoint(((t=this.steps[this.steps.length-1])===null||t===void 0?void 0:t.posY)-((s=this.steps[this.steps.length-2])===null||s===void 0?void 0:s.posY),this.swipeNextSensivity,n),i=this.settings.fastSwipeClose&&this.breakpoints.currentBreakpoint<n);let a=!1;this.isFormElement(document.activeElement)&&!this.isFormElement(e.target)&&this.steps.length===2&&(a=!0),this.instance.emit("onDragEnd",e),this.steps=[],delete this.startPointOverTop,this.allowClick||a||(i?this.instance.destroy({animate:!0}):(this.instance.checkOpacityAttr(n),this.instance.checkOverflowAttr(n),this.instance.setGrabCursor(!0,!1),this.settings.bottomClose&&n===this.breakpoints.breaks.bottom?this.instance.destroy({animate:!0}):(this.instance.getPanelTransformY()===n&&this.instance.emit("onTransitionEnd",{target:this.instance.paneEl}),this.breakpoints.currentBreakpoint=n,this.transitions.doTransition({type:"end",translateY:n}))))}onScroll(e){return q(this,void 0,void 0,function*(){this.isScrolling=!0,this.contentScrollTop=e.target.scrollTop})}onClick(e){if(this.allowClick){if(!this.device.cordova&&this.device.android&&this.isFormElement(e.target))this.keyboardEvents.onKeyboardShowCb({keyboardHeight:this.instance.screen_height-window.innerHeight});else if(this.settings.clickBottomOpen){if(this.isFormElement(document.activeElement))return;if(this.breakpoints.breaks.bottom===this.instance.getPanelTransformY()){let t;this.settings.breaks.top.enabled&&(t="top"),this.settings.breaks.middle.enabled&&(t="middle"),this.instance.moveToBreak(t)}}}else this.settings.preventClicks&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())}fastSwipeNext(e){var t,s;const i=((t=this.steps[this.steps.length-1])===null||t===void 0?void 0:t["pos"+e])-((s=this.steps[this.steps.length-2])===null||s===void 0?void 0:s["pos"+e]);return Math.abs(i)>=this.swipeNextSensivity}handleSuperposition(e){if(!this.settings.upperThanTop&&(e.newVal<=this.breakpoints.topper||e.clientY<=this.breakpoints.topper&&!this.settings.zStack))return this.steps=[],{y:this.breakpoints.topper};if(this.settings.upperThanTop&&(e.newVal<=this.breakpoints.topper||this.startPointOverTop)){this.startPointOverTop||(this.startPointOverTop=e.clientY),this.startPointOverTop<e.clientY&&delete this.startPointOverTop;const t=this.instance.screen_height-this.instance.screenHeightOffset,s=(t-this.instance.getPanelTransformY())/(t-this.breakpoints.topper)/8;return{y:this.instance.getPanelTransformY()+e.diffY*s}}return!this.settings.lowerThanBottom&&e.newVal>=this.breakpoints.bottomer?{y:this.breakpoints.bottomer}:void 0}getEventClientYX(e,t){var s,i;const n=e.type===t&&e.targetTouches&&(e.targetTouches[0]||e.changedTouches[0]),a=e.type===t?n==null?void 0:n.clientY:e.clientY,c=e.type===t?n==null?void 0:n.clientX:e.clientX,p=Date.now()-(((s=this.steps[this.steps.length-1])===null||s===void 0?void 0:s.time)||0);return{clientY:a,clientX:c,velocityY:Math.abs(a-(((i=this.steps[this.steps.length-1])===null||i===void 0?void 0:i.posY)||0))/p}}scrollPreventDrag(e){let t=!1;return this.contentScrollTop>0&&(t=!0),t}willScrolled(){return!(!this.isElementScrollable(this.instance.overflowEl)||this.instance.overflowEl.style.overflow==="hidden")}isDraggableElement(e){return e.target===this.instance.draggableEl||e.target===this.instance.moveEl}isFormElement(e){return!!(e&&e.tagName&&["input","select","option","textarea","button","label"].includes(e.tagName.toLowerCase()))}isElementScrollable(e){return e.scrollHeight>e.clientHeight}}class xi{constructor(e){this.instance=e,this.inputBluredbyMove=!1,this.keyboardVisibleResize=!1,this.inputBottomOffset=0,this.previousInputBottomOffset=0,this.prevNewHeight=0,this.onKeyboardShowCb=t=>this.onKeyboardShow(t),this.onKeyboardWillHideCb=t=>this.onKeyboardWillHide(t),this.onWindowResizeCb=t=>this.onWindowResize(t),this.device=this.instance.device,this.breakpoints=this.instance.breakpoints}onKeyboardShow(e){return q(this,void 0,void 0,function*(){if(!this.isPaneDescendant(document.activeElement)||!this.isOnViewport())return;this.keyboardVisibleResize=!0,this.fixBodyKeyboardResize(!0);let t=-1*(this.instance.getPanelTransformY()-this.instance.screen_height);const s=document.activeElement,i=this.getActiveInputClientBottomRect(),n=this.instance.screen_height-i-this.inputBottomOffset;let a=this.device.cordova&&this.device.android?130:100,c=0,p=t+(e.keyboardHeight-n);if(this.prevNewHeight&&(c=this.previousInputBottomOffset-i,p=this.prevNewHeight),!s.isEqualNode(this.prevFocusedElement)&&e.keyboardHeight>n){this.prevNewHeight=p-c,this.prevFocusedElement=document.activeElement;let d=p-c+a;d>this.instance.getPaneHeight()+e.keyboardHeight&&(d=this.instance.getPaneHeight()+e.keyboardHeight),yield this.instance.moveToHeight(d);const h=this.getActiveInputClientBottomRect();this.previousInputBottomOffset=h,this.inputBottomOffset||(this.inputBottomOffset=i-h)}})}onKeyboardWillHide(e){this.isOnViewport()&&(this.fixBodyKeyboardResize(!1),this.inputBottomOffset=0,this.previousInputBottomOffset=0,this.prevNewHeight=0,delete this.prevFocusedElement,this.inputBluredbyMove?this.inputBluredbyMove=!1:this.instance.isHidden()||this.instance.getPanelTransformY()!==this.breakpoints.breaks[this.breakpoints.prevBreakpoint]&&this.instance.moveToBreak(this.breakpoints.prevBreakpoint))}onWindowResize(e){return q(this,void 0,void 0,function*(){if(this.isFormElement(document.activeElement))this.device.cordova||this.onKeyboardShow({keyboardHeight:this.instance.screen_height-window.innerHeight});else{if(this.keyboardVisibleResize)return this.keyboardVisibleResize=!1,void(this.device.cordova||this.onKeyboardWillHide({}));yield new Promise(t=>setTimeout(()=>t(!0),150)),this.instance.updateScreenHeights(),this.breakpoints.buildBreakpoints(JSON.parse(this.breakpoints.lockedBreakpoints))}})}isPaneDescendant(e){if(!e)return!1;let t=e.parentNode;for(;t!=null;){if(t==this.instance.paneEl)return!0;t=t.parentNode}return!1}isFormElement(e){return!!(e&&e.tagName&&["input","select","option","textarea","button","label"].includes(e.tagName.toLowerCase()))}isOnViewport(){return!this.instance.paneEl||this.instance.paneEl.offsetWidth!==0||this.instance.paneEl.offsetHeight!==0}getActiveInputClientBottomRect(){var e,t;return document.activeElement.classList.contains("native-textarea")||document.activeElement.classList.contains("native-input")?((t=(e=document.activeElement.parentElement)===null||e===void 0?void 0:e.parentElement)===null||t===void 0?void 0:t.parentElement).getBoundingClientRect().bottom:document.activeElement.getBoundingClientRect().bottom}fixBodyKeyboardResize(e){if(!this.instance.paneEl)return;const t=document.querySelector("meta[name=viewport]");window.requestAnimationFrame(()=>{e?(document.documentElement.style.setProperty("overflow","hidden"),document.body.style.setProperty("min-height",`${this.instance.screen_height}px`),t.setAttribute("content","height="+this.instance.screen_height+", width=device-width, initial-scale=1.0")):(document.documentElement.style.removeProperty("overflow"),document.body.style.removeProperty("min-height"),t.setAttribute("content","viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"))})}}class Oi{constructor(){this.instance={initialBreak:"middle",horizontal:!1,horizontalOffset:null,inverse:!1,parentElement:null,followerElement:null,cssClass:null,fitHeight:!1,maxFitHeight:null,fitScreenHeight:!0,ionContentScroll:!1,backdrop:!1,backdropBlur:!1,backdropOpacity:.6,animationType:"ease",animationDuration:300,dragBy:null,bottomOffset:0,bottomClose:!1,fastSwipeClose:!1,fastSwipeSensivity:3,freeMode:!1,buttonDestroy:!0,topperOverflow:!0,topperOverflowOffset:0,lowerThanBottom:!0,upperThanTop:!1,showDraggable:!0,draggableOver:!1,clickBottomOpen:!0,preventClicks:!0,handleKeyboard:!0,simulateTouch:!0,passiveListeners:!0,touchMoveStopPropagation:!1,touchAngle:45,breaks:{},modal:null,zStack:null,events:null,modules:null}}}class Ii{constructor(e){this.instance=e,this.breaks={},this.brs=[],this.beforeBuildBreakpoints=()=>{},this.defaultBreaksConf={top:{enabled:!0,height:window.innerHeight-47.25},middle:{enabled:!0,height:300},bottom:{enabled:!0,height:100}},this.settings=this.instance.settings}buildBreakpoints(e,t=0,s=!0){var i,n;return q(this,void 0,void 0,function*(){if(this.breaks={},this.conf=e,this.settings.bottomOffset=t||this.settings.bottomOffset,yield this.beforeBuildBreakpoints(),["top","middle","bottom"].forEach(a=>{var c;this.settings.breaks[a]||(this.settings.breaks[a]=this.defaultBreaksConf[a]),this.conf&&this.conf[a]&&(this.settings.breaks[a]=this.conf[a]),this.instance.emit("beforeBreakHeightApplied",{break:a}),!((c=this.settings.breaks[a])===null||c===void 0)&&c.enabled&&(this.breaks[a]=this.breaks[a]||this.instance.screenHeightOffset,this.breaks[a]-=this.settings.bottomOffset,this.breaks[a]-=this.settings.breaks[a].height)}),this.lockedBreakpoints||(this.lockedBreakpoints=JSON.stringify(this.settings.breaks)),this.instance.isPanePresented()||this.settings.breaks[this.settings.initialBreak].enabled||console.warn("Cupertino Pane: Please set initialBreak for enabled breakpoint"),this.settings.breaks.middle.height>=this.settings.breaks.top.height&&console.warn("Cupertino Pane: Please set middle height lower than top height"),this.settings.breaks.middle.height<=this.settings.breaks.bottom.height&&console.warn("Cupertino Pane: Please set bottom height lower than middle height"),this.brs=[],["top","middle","bottom"].forEach(a=>{this.settings.breaks[a].enabled&&this.brs.push(this.breaks[a])}),this.topper=this.brs.reduce((a,c)=>c<a?c:a),this.bottomer=this.brs.reduce((a,c)=>Math.abs(c)>Math.abs(a)?c:a),this.instance.isPanePresented()||(this.currentBreakpoint=this.breaks[this.settings.initialBreak]),this.instance.isPanePresented()&&(!((i=this.settings.breaks[this.prevBreakpoint])===null||i===void 0)&&i.enabled&&(this.instance.isHidden()||this.instance.moveToBreak(this.prevBreakpoint,s?"breakpoint":"move")),!(!((n=this.settings.breaks[this.prevBreakpoint])===null||n===void 0)&&n.enabled)&&!this.instance.isHidden())){let a=this.instance.swipeNextPoint(1,1,this.getClosestBreakY());const c=Object.entries(this.breaks).find(p=>p[1]===a);this.instance.moveToBreak(c[0])}this.instance.scrollElementInit(),this.instance.checkOpacityAttr(this.currentBreakpoint),this.instance.checkOverflowAttr(this.currentBreakpoint),this.instance.emit("buildBreakpointsCompleted")})}getCurrentBreakName(){return this.breaks.top===this.currentBreakpoint?"top":this.breaks.middle===this.currentBreakpoint?"middle":this.breaks.bottom===this.currentBreakpoint?"bottom":null}getClosestBreakY(){return this.brs.reduce((e,t)=>Math.abs(t-this.instance.getPanelTransformY())<Math.abs(e-this.instance.getPanelTransformY())?t:e)}}var A;(function(r){r.Present="present",r.Destroy="destroy",r.Move="move",r.Breakpoint="breakpoint",r.Hide="hide",r.TouchEnd="end"})(A||(A={}));class Fi{constructor(e){this.instance=e,this.isPaneHidden=!1,this.settings=this.instance.settings,this.breakpoints=this.instance.breakpoints}doTransition(e={}){return new Promise(t=>q(this,void 0,void 0,function*(){var s,i;if(e.type===A.Move)return this.instance.emit("onMoveTransitionStart",{translateY:e.translateY}),this.instance.paneEl.style.transition="all 0ms linear 0ms",this.setPaneElTransform(e),t(!0);const n=()=>(e.type===A.Destroy&&this.instance.destroyResets(),this.instance.paneEl.style.transition="initial",e.type===A.Hide&&(this.isPaneHidden=!0),e.type!==A.Breakpoint&&e.type!==A.Present&&e.type!==A.TouchEnd||(this.isPaneHidden=!1),e.type!==A.Hide&&e.type!==A.Destroy||!this.instance.ionContent||this.settings.ionContentScroll||this.doesPanesExists()||this.instance.ionContent.setAttribute("scroll-y","true"),this.instance.emit("onTransitionEnd",{type:e.type,target:document.body.contains(this.instance.paneEl)?this.instance.paneEl:null}),this.instance.paneEl.removeEventListener("transitionend",n),t(!0));if(e.type===A.Breakpoint||e.type===A.TouchEnd||e.type===A.Present||e.type===A.Hide||e.type===A.Destroy){let a=!((s=e.conf)===null||s===void 0)&&s.transition?JSON.parse(JSON.stringify(e.conf.transition)):{};if(e.type===A.TouchEnd&&this.settings.freeMode)return t(!0);const c=Object.entries(this.breakpoints.breaks).find(f=>f[1]===e.translateY);let p=c&&((i=this.settings.breaks[c[0]])===null||i===void 0?void 0:i.bounce),d=this.buildTransitionValue(p,a.duration);this.instance.paneEl.style.setProperty("transition",d),this.instance.emit("onTransitionStart",{type:e.type,translateY:{new:e.translateY},transition:this.instance.paneEl.style.transition}),this.setPaneElTransform(e),a.to&&(a.to.transform||(a.to.transform=`translateY(${this.breakpoints.breaks[this.settings.initialBreak]}px) translateZ(0px)`),Object.assign(this.instance.paneEl.style,a.to));let h=Object.entries(this.breakpoints.breaks).find(f=>f[1]===e.translateY);h&&(this.breakpoints.prevBreakpoint=h[0]),this.instance.paneEl.addEventListener("transitionend",n)}}))}setPaneElTransform(e){this.instance.paneEl.style.transform=`translateY(${e.translateY}px) translateZ(0px)`}buildTransitionValue(e,t){return e?"all 300ms cubic-bezier(.155,1.105,.295,1.12)":`all ${t||this.settings.animationDuration}ms ${this.settings.animationType}`}doesPanesExists(){return!!document.querySelector(".cupertino-pane-wrapper")}}function Hi(r,e,t){if(!this.eventsListeners||typeof e!="function")return;const s=t?"unshift":"push";r.split(" ").forEach(i=>{this.eventsListeners[i]||(this.eventsListeners[i]=[]),this.eventsListeners[i][s](e)})}function Mi(...r){if(!this.eventsListeners)return;let e=r[0],t=r.slice(1,r.length);(Array.isArray(e)?e:e.split(" ")).forEach(s=>{var i;!((i=this.eventsListeners)===null||i===void 0)&&i[s]&&this.eventsListeners[s].forEach(n=>n.apply(this,t))})}class Ri{constructor(e){this.instance=e,this.zStackDefaults={pushElements:null,minPushHeight:null,cardBorderRadius:null,cardYOffset:0,cardZScale:.93,cardContrast:.85,stackZAngle:160},this.breakpoints=this.instance.breakpoints,this.settings=this.instance.settings,this.settings.zStack&&(this.instance.setZstackConfig=t=>q(this,void 0,void 0,function*(){return this.setZstackConfig(t)}),this.instance.on("rendered",()=>{this.setZstackConfig(this.settings.zStack),this.setPushMultiplicators()}),this.instance.on("beforePresentTransition",t=>{t.animate||this.settings.zStack.pushElements.forEach(s=>this.pushTransition(document.querySelector(s),this.breakpoints.breaks[this.settings.initialBreak],"unset"))}),this.instance.on("onMoveTransitionStart",()=>{this.settings.zStack.pushElements.forEach(t=>this.pushTransition(document.querySelector(t),this.instance.getPanelTransformY(),"all 0ms linear 0ms"))}),this.instance.on("onTransitionStart",t=>{this.settings.zStack.pushElements.forEach(s=>this.pushTransition(document.querySelector(s),t.translateY.new,`all ${this.settings.animationDuration}ms ${this.settings.animationType} 0s`))}))}setZstackConfig(e){this.settings.zStack=e?Object.assign(Object.assign({},this.zStackDefaults),e):null}pushTransition(e,t,s){let i=this.settings.zStack.pushElements;e.style.transition=s,e.style.overflow=this.settings.zStack.cardBorderRadius&&"hidden",t=this.instance.screenHeightOffset-t;const n=this.settings.zStack.minPushHeight?this.settings.zStack.minPushHeight:this.instance.screenHeightOffset-this.breakpoints.bottomer,a=this.instance.screenHeightOffset-this.breakpoints.topper;let c=this.getPushMulitplicator(e),p=Math.pow(this.settings.zStack.cardZScale,c),d=Math.pow(this.settings.zStack.cardZScale,c-1),h=6+this.settings.zStack.cardYOffset,f=h*c*-1,b=f+h,m=Math.pow(this.settings.zStack.cardContrast,c),C=Math.pow(this.settings.zStack.cardContrast,c-1);const _=(T,S,w,Y)=>{let F=Math.pow(T,this.settings.zStack.stackZAngle/100);e.style.transform=`translateY(${S*(F/T)}px) scale(${T})`,e.style.borderRadius=`${Y}px`,e.style.filter=`contrast(${w})`;let H=document.querySelector(i[i.length-1]);t||e.className!==H.className||this.clearPushMultiplicators()};if(t<=n)return void _(d,b,C,0);const y=(T,S)=>{let w=-1*(a*S-n*T);return w-=(T-S)*t,w/=n-a,w>S&&(w=S),w<T&&(w=T),w};_(y(p,d),y(f,b),y(m,C),-1*y(-1*this.settings.zStack.cardBorderRadius,0))}setPushMultiplicators(){this.settings.zStack.pushElements.forEach(e=>{let t=document.querySelector(e),s=this.getPushMulitplicator(t);s=s?s+1:1,t.style.setProperty("--push-multiplicator",`${s}`)})}getPushMulitplicator(e){let t=e.style.getPropertyValue("--push-multiplicator");return parseInt(t)}clearPushMultiplicators(){for(let e=0;e<this.settings.zStack.pushElements.length;e++){let t=document.querySelector(this.settings.zStack.pushElements[e]),s=this.getPushMulitplicator(t);s-=1,s?t.style.setProperty("--push-multiplicator",`${s}`):t.style.removeProperty("--push-multiplicator")}}}class Ni{constructor(e){this.instance=e,this.breakpoints=this.instance.breakpoints,this.transitions=this.instance.transitions,this.settings=this.instance.settings,this.settings.followerElement&&(this.instance.on("rendered",()=>{var t;document.querySelector(this.settings.followerElement)?(this.followerEl=document.querySelector(this.settings.followerElement),this.followerEl.style.willChange="transform, border-radius",this.followerEl.style.transform="translateY(0px) translateZ(0px)",this.followerEl.style.transition=this.transitions.buildTransitionValue((t=this.settings.breaks[this.instance.currentBreak()])===null||t===void 0?void 0:t.bounce)):console.warn("Cupertino Pane: wrong follower element selector specified",this.settings.followerElement)}),this.instance.on("onMoveTransitionStart",t=>{this.followerEl.style.transition="all 0ms linear 0ms",this.followerEl.style.transform=`translateY(${t.translateY-this.breakpoints.breaks[this.settings.initialBreak]}px) translateZ(0px)`}),this.instance.on("onMoveTransitionStart",t=>{this.followerEl.style.transition="initial"}),this.instance.on("onTransitionStart",t=>{this.followerEl.style.transition=t.transition,this.followerEl.style.transform=`translateY(${t.translateY.new-this.breakpoints.breaks[this.settings.initialBreak]}px) translateZ(0px)`}))}}class Ai{constructor(e){this.instance=e,this.touchMoveBackdropCb=t=>this.touchMoveBackdrop(t),this.settings=this.instance.settings,this.events=this.instance.events,this.settings.backdrop&&(this.instance.backdrop=t=>this.backdrop(t),this.instance.on("rendered",()=>{this.instance.addStyle(`
        .cupertino-pane-wrapper .backdrop {
          overflow: hidden;
          position: fixed;
          width: 100%;
          bottom: 0;
          right: 0;
          left: 0;
          top: 0;
          display: none;
          z-index: 10;
          ${j.backdropFilter&&this.settings.backdropBlur?`
            backdrop-filter: saturate(180%) blur(10px);
            -webkit-backdrop-filter: saturate(180%) blur(10px);
          `:""}
        }
      `),this.settings.backdrop&&this.renderBackdrop()}),this.instance.on("beforePresentTransition",t=>{t.animate||(this.backdropEl.style.display="block")}),this.instance.on("onTransitionStart",t=>{this.settings.backdrop&&(this.instance.isHidden()||t.type===A.Hide||t.type===A.Destroy||t.type===A.Present)&&(this.backdropEl.style.backgroundColor="rgba(0,0,0,.0)",this.backdropEl.style.transition=`all ${this.settings.animationDuration}ms ${this.settings.animationType} 0s`,t.type!==A.Hide&&t.type!==A.Destroy&&(this.backdropEl.style.display="block",setTimeout(()=>{this.backdropEl.style.backgroundColor=`rgba(0,0,0, ${this.settings.backdropOpacity})`},50)))}),this.instance.on("onTransitionEnd",t=>{this.backdropEl&&(t.type!==A.Destroy&&t.type!==A.Hide||(this.backdropEl.style.transition="initial",this.backdropEl.style.display="none"))}),j.touch&&(this.instance.on("onDidPresent",()=>{var t;(t=this.backdropEl)===null||t===void 0||t.addEventListener(this.events.touchEvents.move,this.touchMoveBackdropCb,!!j.passiveListener&&{passive:!1,capture:!1})}),this.instance.on("onDidDismiss",t=>{var s;(s=this.backdropEl)===null||s===void 0||s.removeEventListener(this.events.touchEvents.move,this.touchMoveBackdropCb)})))}backdrop(e={show:!0}){var t,s;if(!this.instance.isPanePresented())return console.warn("Cupertino Pane: Present pane before call backdrop()"),null;this.isBackdropPresented()||(this.renderBackdrop(),j.touch&&((t=this.backdropEl)===null||t===void 0||t.removeEventListener(this.events.touchEvents.move,this.touchMoveBackdropCb),(s=this.backdropEl)===null||s===void 0||s.addEventListener(this.events.touchEvents.move,this.touchMoveBackdropCb,!!j.passiveListener&&{passive:!1,capture:!1})));const i=()=>{this.backdropEl.style.transition="initial",this.backdropEl.style.display="none",this.backdropEl.removeEventListener("transitionend",i)};if(this.backdropEl.style.transition=`all ${this.settings.animationDuration}ms ${this.settings.animationType} 0s`,this.backdropEl.style.backgroundColor="rgba(0,0,0,.0)",e.show)this.backdropEl.style.display="block",setTimeout(()=>{this.backdropEl.style.backgroundColor=`rgba(0,0,0, ${this.settings.backdropOpacity})`},50);else{if(this.backdropEl.style.display==="none")return;this.backdropEl.addEventListener("transitionend",i)}}renderBackdrop(){this.backdropEl=document.createElement("div"),this.backdropEl.classList.add("backdrop"),this.backdropEl.style.transition=`all ${this.settings.animationDuration}ms ${this.settings.animationType} 0s`,this.backdropEl.style.backgroundColor=`rgba(0,0,0, ${this.settings.backdropOpacity})`,this.instance.wrapperEl.appendChild(this.backdropEl),this.backdropEl.addEventListener("click",e=>this.instance.emit("onBackdropTap",e))}isBackdropPresented(){return!!document.querySelector(".cupertino-pane-wrapper .backdrop")}touchMoveBackdrop(e){this.settings.touchMoveStopPropagation&&e.stopPropagation()}}class Vi{constructor(e){this.instance=e,this.calcHeightInProcess=!1,this.breakpoints=this.instance.breakpoints,this.settings=this.instance.settings,this.settings.fitHeight&&(this.instance.calcFitHeight=t=>q(this,void 0,void 0,function*(){return this.calcFitHeight(t)}),this.instance.setOverflowHeight=()=>{},this.instance.on("DOMElementsReady",()=>{this.instance.wrapperEl.classList.add("fit-height")}),this.instance.on("onDidPresent",()=>{this.instance.paneEl.style.height="unset"}),this.instance.on("onTransitionEnd",()=>{this.instance.paneEl.style.height="unset"}),this.instance.on("onWillPresent",()=>{this.breakpoints.beforeBuildBreakpoints=()=>this.beforeBuildBreakpoints()}),this.instance.on("beforeBreakHeightApplied",t=>{var s;this.settings.fitScreenHeight&&(((s=this.settings.breaks[t.break])===null||s===void 0?void 0:s.height)>this.instance.screen_height&&(this.settings.breaks[t.break].height=this.instance.screen_height-this.settings.bottomOffset),this.settings.breaks.top&&this.settings.breaks.middle&&this.settings.breaks.top.height-50<=this.settings.breaks.middle.height&&(this.settings.breaks.middle.enabled=!1,this.settings.initialBreak="top")),t.break==="top"&&(this.settings.breaks.top.height>this.instance.screen_height?(this.settings.breaks.top.height=this.instance.screen_height-2*this.settings.bottomOffset,this.settings.topperOverflow=!0,this.settings.upperThanTop=!1):this.instance.overflowEl&&!this.settings.maxFitHeight&&(this.settings.topperOverflow=!1,this.instance.overflowEl.style.overflowY="hidden"))},!0))}beforeBuildBreakpoints(){var e,t,s;return q(this,void 0,void 0,function*(){this.settings.fitScreenHeight=!1,this.settings.initialBreak="top",this.settings.topperOverflow=!1;let i=yield this.getPaneFitHeight();this.settings.maxFitHeight&&i>this.settings.maxFitHeight&&(i=this.settings.maxFitHeight,this.settings.topperOverflow=!0),this.breakpoints.conf={top:{enabled:!0,height:i},middle:{enabled:!1}},this.breakpoints.conf.top.bounce=(t=(e=this.settings.breaks)===null||e===void 0?void 0:e.top)===null||t===void 0?void 0:t.bounce,this.breakpoints.conf.bottom=((s=this.settings.breaks)===null||s===void 0?void 0:s.bottom)||{enabled:!0,height:0}})}calcFitHeight(e=!0){return q(this,void 0,void 0,function*(){return this.instance.wrapperEl&&this.instance.el?this.calcHeightInProcess?(console.warn("Cupertino Pane: calcFitHeight() already in process"),null):void(yield this.breakpoints.buildBreakpoints(this.breakpoints.lockedBreakpoints,null,e)):null})}getPaneFitHeight(){return q(this,void 0,void 0,function*(){this.calcHeightInProcess=!0;let e=this.instance.el.querySelectorAll("img");this.instance.el.style.height="unset",this.instance.rendered||(this.instance.el.style.visibility="hidden",this.instance.el.style.pointerEvents="none",this.instance.el.style.display="block",this.instance.wrapperEl.style.visibility="hidden",this.instance.wrapperEl.style.pointerEvents="none",this.instance.wrapperEl.style.display="block");let t=[];e.length&&(t=Array.from(e).map(i=>new Promise(n=>{if(i.height||i.complete&&i.naturalHeight)return n(!0);i.onload=()=>n(!0),i.onerror=()=>n(!0)}))),yield Promise.all(t),yield new Promise(i=>requestAnimationFrame(i));let s=Math.floor(this.instance.paneEl.getBoundingClientRect().height);return this.paneElHeight!==s&&(this.instance.paneEl.style.height=`${s<=this.paneElHeight?this.paneElHeight:s}px`),this.instance.rendered||(this.instance.el.style.visibility="unset",this.instance.el.style.pointerEvents="unset",this.instance.el.style.display="none",this.instance.wrapperEl.style.visibility="unset",this.instance.wrapperEl.style.pointerEvents="unset",this.instance.wrapperEl.style.display="none"),this.calcHeightInProcess=!1,this.paneElHeight=s,this.paneElHeight})}}class Li{constructor(e){this.instance=e,this.breakpoints=this.instance.breakpoints,this.settings=this.instance.settings,this.events=this.instance.events,this.settings.inverse&&(this.settings.buttonDestroy=!1,this.instance.getPaneHeight=()=>this.getPaneHeight(),this.instance.updateScreenHeights=()=>this.updateScreenHeights(),this.instance.setOverflowHeight=()=>this.settings.fitHeight?{}:this.setOverflowHeight(),this.instance.checkOpacityAttr=()=>{},this.instance.checkOverflowAttr=t=>this.checkOverflowAttr(t),this.instance.prepareBreaksSwipeNextPoint=()=>this.prepareBreaksSwipeNextPoint(),this.events.handleSuperposition=t=>this.handleSuperposition(t),this.events.scrollPreventDrag=t=>this.scrollPreventDrag(t),this.events.onScroll=()=>this.onScroll(),this.instance.on("DOMElementsReady",()=>{this.instance.wrapperEl.classList.add("inverse")}),this.instance.on("rendered",()=>{this.instance.addStyle(`
        .cupertino-pane-wrapper.inverse .pane {
          border-radius: 0 0 20px 20px;
          border-radius: 0 0
                        var(--cupertino-pane-border-radius, 20px) 
                        var(--cupertino-pane-border-radius, 20px);
        }
        .cupertino-pane-wrapper.inverse:not(.fit-height) .pane {
          padding-bottom: 15px; 
        }
        .cupertino-pane-wrapper.inverse .draggable {
          bottom: 0;
          top: initial;
        }
        .cupertino-pane-wrapper.inverse .draggable.over {
          bottom: -30px;
          top: initial;
        }
        .cupertino-pane-wrapper.inverse .move {
          margin-top: 15px;
        }
        .cupertino-pane-wrapper.inverse .draggable.over .move {
          margin-top: -5px;
        }
      `)}),this.instance.on("beforeBreakHeightApplied",t=>{var s;!((s=this.settings.breaks[t.break])===null||s===void 0)&&s.enabled&&(this.breakpoints.breaks[t.break]=2*(this.settings.breaks[t.break].height+this.settings.bottomOffset))},!1),this.instance.on("buildBreakpointsCompleted",()=>{this.breakpoints.topper=this.breakpoints.bottomer,this.instance.paneEl.style.top=`-${this.breakpoints.bottomer-this.settings.bottomOffset}px`}))}getPaneHeight(){return this.breakpoints.bottomer-this.settings.bottomOffset}updateScreenHeights(){this.instance.screen_height=window.innerHeight,this.instance.screenHeightOffset=0}setOverflowHeight(){this.instance.overflowEl.style.height=this.getPaneHeight()-30-this.settings.topperOverflowOffset-this.instance.overflowEl.offsetTop+"px"}checkOverflowAttr(e){this.settings.topperOverflow&&this.instance.overflowEl&&(this.instance.overflowEl.style.overflowY=e>=this.breakpoints.bottomer?"auto":"hidden")}prepareBreaksSwipeNextPoint(){let e={},t={};return e.top=this.breakpoints.breaks.bottom,e.middle=this.breakpoints.breaks.middle,e.bottom=this.breakpoints.breaks.top,t.top=Object.assign({},this.settings.breaks.bottom),t.middle=Object.assign({},this.settings.breaks.middle),t.bottom=Object.assign({},this.settings.breaks.top),{brs:e,settingsBreaks:t}}handleSuperposition(e){if(this.settings.upperThanTop&&(e.newVal>=this.breakpoints.topper||this.events.startPointOverTop)){this.events.startPointOverTop||(this.events.startPointOverTop=e.clientY),this.events.startPointOverTop>e.clientY&&delete this.events.startPointOverTop;const t=this.instance.screen_height-this.instance.screenHeightOffset,s=(t-this.instance.getPanelTransformY())/(t-this.breakpoints.topper)/8;return{y:this.instance.getPanelTransformY()+e.diffY*s}}if(!this.settings.upperThanTop&&e.newVal>=this.breakpoints.topper)return{y:this.breakpoints.topper}}scrollPreventDrag(e){let t=!1;return this.events.willScrolled()&&this.isOverflowEl(e.target)&&(t=!0),t}isOverflowEl(e){if(!e)return!1;let t=e.parentNode;for(;t!=null;){if(t==this.instance.overflowEl)return!0;t=t.parentNode}return!1}onScroll(){return q(this,void 0,void 0,function*(){this.events.isScrolling=!0})}}class me{static CollectSettings(e){return e.horizontal?Object.assign(Object.assign({},e),me.forceSettings):e}constructor(e){if(this.instance=e,this.settings=this.instance.settings,this.transitions=this.instance.transitions,this.events=this.instance.events,!this.settings.horizontal)return null;this.transitions.setPaneElTransform=t=>this.setPaneElTransform(t),this.instance.on("onTransitionEnd",t=>{t.type!=="breakpoint"&&t.type!=="present"||this.instance.getPanelTransformX()||this.calcHorizontalBreaks()}),this.instance.on("onDidPresent",t=>{t.animate||this.calcHorizontalBreaks()}),this.instance.on("onDragEnd",t=>{this.fastSwipeNext=this.events.fastSwipeNext("X")})}calcHorizontalBreaks(){this.defaultRect={width:this.instance.paneEl.getBoundingClientRect().width,left:this.instance.paneEl.getBoundingClientRect().left,right:this.instance.paneEl.getBoundingClientRect().right},this.horizontalBreaks=[-this.defaultRect.left+this.settings.horizontalOffset,window.innerWidth-this.defaultRect.left-this.defaultRect.width-this.settings.horizontalOffset]}setPaneElTransform(e){let t=e.translateX;e.type==="end"&&(t=this.getClosestBreakX(),this.fastSwipeNext&&(this.currentBreakpoint==="left"&&this.instance.getPanelTransformX()>this.horizontalBreaks[0]&&(t=this.horizontalBreaks[1]),this.currentBreakpoint==="right"&&this.instance.getPanelTransformX()<this.horizontalBreaks[1]&&(t=this.horizontalBreaks[0])),this.currentBreakpoint=t===this.horizontalBreaks[0]?"left":"right"),this.instance.paneEl.style.transform=`translateX(${t||0}px) translateY(${e.translateY}px) translateZ(0px)`}getClosestBreakX(){return this.horizontalBreaks.reduce((e,t)=>Math.abs(t-this.instance.getPanelTransformX())<Math.abs(e-this.instance.getPanelTransformX())?t:e)}}me.forceSettings={touchAngle:null};class Z{static CollectSettings(e){return e.modal?Object.assign(Object.assign({},e),Z.ForceSettings):e}constructor(e){this.instance=e,this.modalDefaults={transition:"fade",flying:!1,dismissOnIntense:!1},this.settings=this.instance.settings,this.events=this.instance.events,this.breakpoints=this.instance.breakpoints,this.transitions=this.instance.transitions,this.settings.modal&&(this.settings.modal=typeof this.settings.modal=="object"?Object.assign(Object.assign({},this.modalDefaults),this.settings.modal):this.modalDefaults,this.instance.customPresent=this.instance.present,this.instance.present=t=>this.present(t),this.instance.customDestroy=this.instance.destroy,this.instance.destroy=t=>this.destroy(t),this.events.handleSuperposition=t=>this.handleSuperposition(t),this.transitions.setPaneElTransform=t=>this.setPaneElTransform(t),this.instance.on("beforeBreakHeightApplied",t=>{t.break==="top"&&(this.settings.breaks.top.height-=2*this.settings.bottomOffset,this.settings.breaks.top.height+=(this.instance.screen_height-this.settings.breaks.top.height)/2),t.break==="bottom"&&(this.settings.breaks.bottom={enabled:!1}),this.instance.addStyle(`
        .cupertino-pane-wrapper .pane {
          transform-origin: center ${this.breakpoints.breaks[this.settings.initialBreak]}px
        }
      `)}),this.instance.on("rendered",()=>{this.instance.addStyle(`
        .cupertino-pane-wrapper .pane {
          border-radius: var(--cupertino-pane-border-radius, 20px) 
                         var(--cupertino-pane-border-radius, 20px)
                         var(--cupertino-pane-border-radius, 20px)
                         var(--cupertino-pane-border-radius, 20px);
          width: calc(100% - 16px) !important;
          margin: auto;
        }
        .cupertino-pane-wrapper .pane.modal-flying {
          animation: modalFlyingX 2000ms ease-in-out infinite alternate,
                     modalFlyingY 3000ms ease-in-out infinite alternate;
        }
        @keyframes modalFlyingX {
          0% { left: -10px; }
          100% { left: 10px; }
        }
        @keyframes modalFlyingY {
          0% { top: -10px; }
          100% { top: 0px; }
        }
      `),this.settings.modal.flying&&this.instance.paneEl.classList.add("modal-flying"),this.settings.modal.dismissOnIntense&&this.instance.enableDrag()}))}setPaneElTransform(e){let t=e.type==="end"?0:e.translateX;this.instance.paneEl.style.transform=`translateX(${t||0}px) translateY(${e.translateY}px) translateZ(0px)`}present(e){let{transition:t}=e;return t||(t=Z.BuildInTransition[this.settings.modal.transition]),this.instance.customPresent(Object.assign(Object.assign({},e),{transition:t}))}destroy(e){let{transition:t}=e;if(t||(t=JSON.parse(JSON.stringify({duration:Z.BuildInTransition[this.settings.modal.transition].duration,from:Z.BuildInTransition[this.settings.modal.transition].to,to:Z.BuildInTransition[this.settings.modal.transition].from}))),e.fromCurrentPosition){let s=new WebKitCSSMatrix(window.getComputedStyle(this.instance.paneEl).transform);t.to.transform=`translateY(${s.m42}px) translateX(${s.m41}px) translateZ(0px)`}return this.instance.customDestroy(Object.assign(Object.assign({},e),{transition:t}))}handleSuperposition(e){let t=Math.abs(this.instance.getPanelTransformY()-this.breakpoints.topper),s=Math.abs(this.instance.getPanelTransformX());if(this.settings.modal.dismissOnIntense&&(t>40||s>30))return this.instance.disableDrag(),this.destroy({animate:!0,fromCurrentPosition:!0}),!1;const i=this.instance.getPanelTransformY()/this.breakpoints.topper/8,n=this.instance.getPanelTransformX()/this.breakpoints.topper/8;return{y:this.instance.getPanelTransformY()+e.diffY*(i+n),x:this.instance.getPanelTransformX()+e.diffX*(i+n)}}}Z.BuildInTransition={fade:{duration:300,from:{opacity:0},to:{opacity:1}},zoom:{duration:300,from:{opacity:0,scale:.5},to:{opacity:1,scale:1}}},Z.ForceSettings={fitHeight:!0,touchAngle:null,showDraggable:!1};const ze={ZStackModule:Ri,FollowerModule:Ni,BackdropModule:Ai,FitHeightModule:Vi,InverseModule:Li,HorizontalModule:me,ModalModule:Z};class Yi{constructor(e,t={}){if(this.selector=e,this.disableDragEvents=!1,this.preventDismissEvent=!1,this.preventedDismiss=!1,this.rendered=!1,this.settings=new Oi().instance,this.device=new Di,this.modules={},this.eventsListeners={},this.on=Hi,this.emit=Mi,this.calcFitHeight=()=>{if(!this.settings.fitHeight)return console.warn("Cupertino Pane: calcFitHeight() should be used for auto-height panes with enabled fitHeight option"),null},this.swipeNextPoint=(a,c,p)=>{let{brs:d,settingsBreaks:h}=this.prepareBreaksSwipeNextPoint();if(this.breakpoints.currentBreakpoint===d.top){if(a>c){if(h.middle.enabled)return d.middle;if(h.bottom.enabled)return d.middle<p?p:d.bottom}return d.top}if(this.breakpoints.currentBreakpoint===d.middle)return a<-c&&h.top.enabled?d.top:a>c&&h.bottom.enabled?d.bottom:d.middle;if(this.breakpoints.currentBreakpoint===d.bottom){if(a<-c){if(h.middle.enabled)return d.middle>p?p:d.middle;if(h.top.enabled)return d.top}return d.bottom}return p},e instanceof HTMLElement?this.selector=e:this.selector=document.querySelector(e),!this.selector)return void console.warn("Cupertino Pane: wrong selector or DOM element specified",this.selector);if(this.isPanePresented())return void console.error("Cupertino Pane: specified selector or DOM element already in use",this.selector);this.el=this.selector,this.el.style.display="none",this.settings=Object.assign(Object.assign({},this.settings),t);let s=Object.keys(ze).map(a=>ze[a]),i=this.settings.modules||s;i.forEach(a=>a.CollectSettings?this.settings=a.CollectSettings(this.settings):null);let n=this.el.parentElement;this.settings.parentElement&&(n=this.settings.parentElement instanceof HTMLElement?this.settings.parentElement:document.querySelector(this.settings.parentElement)),this.settings.parentElement=n,this.device.ionic&&(this.ionContent=document.querySelector("ion-content"),this.ionApp=document.querySelector("ion-app")),this.settings.events&&Object.keys(this.settings.events).forEach(a=>this.on(a,this.settings.events[a])),this.breakpoints=new Ii(this),this.transitions=new Fi(this),this.keyboardEvents=new xi(this),this.events=new Ti(this),i.forEach(a=>this.modules[this.getModuleRef(a.name)]=new a(this))}drawBaseElements(){this.styleEl=document.createElement("style"),this.styleEl.id=`cupertino-pane-${(Math.random()+1).toString(36).substring(7)}`,this.parentEl=this.settings.parentElement,this.wrapperEl=document.createElement("div"),this.wrapperEl.classList.add("cupertino-pane-wrapper"),this.settings.cssClass&&this.settings.cssClass.split(" ").filter(t=>!!t).forEach(t=>this.wrapperEl.classList.add(t));let e="";e+=`
      .cupertino-pane-wrapper {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
      }
    `,this.paneEl=document.createElement("div"),this.paneEl.style.transform=`translateY(${this.screenHeightOffset}px) translateZ(0px)`,this.paneEl.classList.add("pane"),e+=`
      .cupertino-pane-wrapper .pane {
        position: fixed;
        z-index: 11;
        width: 100%;
        max-width: 500px;
        left: 0px;
        right: 0px;
        margin-left: auto;
        margin-right: auto;
        background: var(--cupertino-pane-background, #ffffff);
        color: var(--cupertino-pane-color, #333333);
        box-shadow: var(--cupertino-pane-shadow, 0 4px 16px rgba(0,0,0,.12));
        will-change: transform;
        padding-top: 15px; 
        border-radius: var(--cupertino-pane-border-radius, 20px) 
                       var(--cupertino-pane-border-radius, 20px) 
                       0 0;
        -webkit-user-select: none;
      }
      .cupertino-pane-wrapper .pane img {
        -webkit-user-drag: none;
      }
    `,this.draggableEl=document.createElement("div"),this.draggableEl.classList.add("draggable"),this.settings.draggableOver&&this.draggableEl.classList.add("over"),e+=`
      .cupertino-pane-wrapper .draggable {
        padding: 5px;
        position: absolute;
        left: 0;
        right: 0;
        margin-left: auto;
        margin-right: auto;
        height: 30px;
        z-index: -1;
        top: 0;
        bottom: initial;
      }
      .cupertino-pane-wrapper .draggable.over {
        top: -30px;
        padding: 15px;
      }
    `,this.moveEl=document.createElement("div"),this.moveEl.classList.add("move"),e+=`
      .cupertino-pane-wrapper .move {
        margin: 0 auto;
        height: 5px;
        background: var(--cupertino-pane-move-background, #c0c0c0);
        width: 36px;
        border-radius: 4px;
      }
      .cupertino-pane-wrapper .draggable.over .move {
        width: 70px; 
        background: var(--cupertino-pane-move-background, rgba(225, 225, 225, 0.6));
        ${j.backdropFilter?`
          backdrop-filter: saturate(180%) blur(20px);
          -webkit-backdrop-filter: saturate(180%) blur(20px);
        `:""}
      }
    `,this.destroyButtonEl=document.createElement("div"),this.destroyButtonEl.classList.add("destroy-button"),e+=`
      .cupertino-pane-wrapper .destroy-button {
        width: 26px;
        height: 26px;
        cursor: pointer;
        position: absolute;
        background: var(--cupertino-pane-destroy-button-background, #ebebeb);
        fill: var(--cupertino-pane-icon-close-color, #7a7a7e);
        right: 20px;
        z-index: 14;
        border-radius: 100%;
        top: 16px;
      }
    `,this.contentEl=this.el,this.contentEl.style.transition=`opacity ${this.settings.animationDuration}ms ${this.settings.animationType} 0s`,this.contentEl.style.overflowX="hidden",this.styleEl.textContent=e.replace(/\s\s+/g," "),document.head.prepend(this.styleEl),this.parentEl.appendChild(this.wrapperEl),this.wrapperEl.appendChild(this.paneEl),this.paneEl.appendChild(this.contentEl),this.settings.showDraggable&&(this.paneEl.appendChild(this.draggableEl),this.draggableEl.appendChild(this.moveEl)),this.emit("DOMElementsReady")}present(e={animate:!1}){var t;return q(this,void 0,void 0,function*(){if(!this.el||!document.body.contains(this.el))return void console.warn("Cupertino Pane: specified DOM element must be attached to the DOM");if(this.isPanePresented()&&this.rendered)return void this.moveToBreak(this.settings.initialBreak);if(this.isPanePresented()&&!this.rendered)return void console.warn("Cupertino Pane: specified selector or DOM element already in use",this.selector);e.animate&&this.device.ionic&&(yield this.ionApp.componentOnReady(),yield new Promise(i=>requestAnimationFrame(i))),this.emit("onWillPresent"),this.updateScreenHeights(),this.drawBaseElements(),yield this.setBreakpoints();let s=!((t=e==null?void 0:e.transition)===null||t===void 0)&&t.from?JSON.parse(JSON.stringify(e.transition.from)):null;return s&&(s.transform||(s.transform=`translateY(${this.breakpoints.breaks[this.settings.initialBreak]}px) translateZ(0px)`),Object.assign(this.paneEl.style,s)),this.wrapperEl.style.display="block",this.contentEl.style.display="block",this.wrapperEl.classList.add("rendered"),this.rendered=!0,this.scrollElementInit(),this.emit("rendered"),this.setGrabCursor(!0),this.settings.buttonDestroy&&(this.paneEl.appendChild(this.destroyButtonEl),this.destroyButtonEl.addEventListener("click",i=>this.destroy({animate:!0,destroyButton:!0})),this.destroyButtonEl.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
          <path d="M278.6 256l68.2-68.2c6.2-6.2 6.2-16.4 0-22.6-6.2-6.2-16.4-6.2-22.6 0L256 233.4l-68.2-68.2c-6.2-6.2-16.4-6.2-22.6 0-3.1 3.1-4.7 7.2-4.7 11.3 0 4.1 1.6 8.2 4.7 11.3l68.2 68.2-68.2 68.2c-3.1 3.1-4.7 7.2-4.7 11.3 0 4.1 1.6 8.2 4.7 11.3 6.2 6.2 16.4 6.2 22.6 0l68.2-68.2 68.2 68.2c6.2 6.2 16.4 6.2 22.6 0 6.2-6.2 6.2-16.4 0-22.6L278.6 256z"/>
        </svg>`),this.device.ionic&&!this.settings.ionContentScroll&&this.ionContent.setAttribute("scroll-y","false"),this.settings.bottomClose&&(this.settings.breaks.bottom.enabled=!0),this.settings.freeMode&&(this.settings.lowerThanBottom=!1),this.device.android&&(document.body.style.overscrollBehaviorY="none"),this.emit("beforePresentTransition",{animate:e.animate}),yield new Promise(i=>requestAnimationFrame(i)),e.animate?yield this.transitions.doTransition({type:"present",conf:e,translateY:this.breakpoints.breaks[this.settings.initialBreak]}):(this.breakpoints.prevBreakpoint=this.settings.initialBreak,this.paneEl.style.transform=`translateY(${this.breakpoints.breaks[this.settings.initialBreak]}px) translateZ(0px)`),this.events.attachAllEvents(),this.emit("onDidPresent",{animate:e.animate}),this})}getPaneHeight(){return this.screen_height-this.breakpoints.topper-this.settings.bottomOffset}updateScreenHeights(){this.screen_height=window.innerHeight,this.screenHeightOffset=window.innerHeight}scrollElementInit(){let e=this.el.querySelectorAll("[overflow-y]");!e.length||e.length>1?this.overflowEl=this.contentEl:(this.overflowEl=e[0],this.overflowEl.style.overflowX="hidden"),this.overflowEl.style.overscrollBehavior="none",this.settings.topperOverflow&&this.settings.upperThanTop&&console.warn('Cupertino Pane: "upperThanTop" allowed for disabled "topperOverflow"'),this.setOverflowHeight()}setOverflowHeight(e=0){this.paneEl.style.height=`${this.getPaneHeight()}px`,this.overflowEl.style.height=this.getPaneHeight()-this.settings.topperOverflowOffset-this.overflowEl.offsetTop-e+"px"}checkOpacityAttr(e){let t=this.el.querySelectorAll("[hide-on-bottom]");t.length&&t.forEach(s=>{s.style.transition=`opacity ${this.settings.animationDuration}ms ${this.settings.animationType} 0s`,s.style.opacity=e>=this.breakpoints.breaks.bottom?"0":"1"})}checkOverflowAttr(e){this.settings.topperOverflow&&this.overflowEl&&(this.overflowEl.style.overflowY=e<=this.breakpoints.topper?"auto":"hidden")}isPanePresented(){let e=Array.from(document.querySelectorAll(".cupertino-pane-wrapper.rendered"));return!!e.length&&!!e.find(t=>t.contains(this.selector))}prepareBreaksSwipeNextPoint(){return{brs:Object.assign({},this.breakpoints.breaks),settingsBreaks:Object.assign({},this.settings.breaks)}}addStyle(e){this.styleEl.textContent+=e.replace(/\s\s+/g," ")}getModuleRef(e){return(e.charAt(0).toLowerCase()+e.slice(1)).replace("Module","")}getPanelTransformY(){return parseFloat(/\.*translateY\((.*)px\)/i.exec(this.paneEl.style.transform)[1])}getPanelTransformX(){let e=/\.*translateX\((.*)px\)/i.exec(this.paneEl.style.transform);return e?parseFloat(e[1]):0}preventDismiss(e=!1){this.preventDismissEvent=e}setGrabCursor(e,t){this.device.desktop&&(this.paneEl.style.cursor=e?t?"grabbing":"grab":"")}disableDrag(){this.disableDragEvents=!0,this.setGrabCursor(!1)}enableDrag(){this.disableDragEvents=!1,this.setGrabCursor(!0)}setBreakpoints(e,t){return q(this,void 0,void 0,function*(){!this.isPanePresented()||e?yield this.breakpoints.buildBreakpoints(e,t):console.warn("Cupertino Pane: Provide any breaks configuration")})}moveToBreak(e,t="breakpoint"){return q(this,void 0,void 0,function*(){return this.isPanePresented()?this.settings.breaks[e].enabled?(this.checkOpacityAttr(this.breakpoints.breaks[e]),this.checkOverflowAttr(this.breakpoints.breaks[e]),yield this.transitions.doTransition({type:t,translateY:this.breakpoints.breaks[e]}),this.breakpoints.currentBreakpoint=this.breakpoints.breaks[e],Promise.resolve(!0)):void console.warn("Cupertino Pane: %s breakpoint disabled",e):(console.warn("Cupertino Pane: Present pane before call moveToBreak()"),null)})}moveToHeight(e){return q(this,void 0,void 0,function*(){if(!this.isPanePresented())return console.warn("Cupertino Pane: Present pane before call moveToHeight()"),null;let t=this.screenHeightOffset?this.screen_height-e:e;this.checkOpacityAttr(t),yield this.transitions.doTransition({type:"breakpoint",translateY:t})})}hide(){return q(this,void 0,void 0,function*(){return this.isPanePresented()?this.isHidden()?(console.warn("Cupertino Pane: Pane already hidden"),null):void(yield this.transitions.doTransition({type:"hide",translateY:this.screenHeightOffset})):(console.warn("Cupertino Pane: Present pane before call hide()"),null)})}isHidden(){return this.isPanePresented()?this.transitions.isPaneHidden:(console.warn("Cupertino Pane: Present pane before call isHidden()"),null)}currentBreak(){return this.isPanePresented()?this.breakpoints.getCurrentBreakName():(console.warn("Cupertino Pane: Present pane before call currentBreak()"),null)}destroy(e={animate:!1,destroyButton:!1}){return q(this,void 0,void 0,function*(){if(!this.rendered)return console.warn("Cupertino Pane: Present pane before call destroy()"),null;this.preventDismissEvent?this.preventedDismiss||(this.emit("onWillDismiss",{prevented:!0}),this.moveToBreak(this.breakpoints.prevBreakpoint)):(this.emit("onWillDismiss"),e.animate?yield this.transitions.doTransition({type:"destroy",conf:e,translateY:this.screenHeightOffset,destroyButton:e.destroyButton}):this.destroyResets(),this.emit("onDidDismiss",{destroyButton:e.destroyButton}))})}destroyResets(){this.keyboardEvents.fixBodyKeyboardResize(!1),this.parentEl.appendChild(this.contentEl),this.wrapperEl.remove(),this.styleEl.remove(),this.events.detachAllEvents(),delete this.rendered,delete this.breakpoints.prevBreakpoint,this.contentEl.style.display="none"}}const pe=We([]);function zi(r){pe.includes(r)||pe.push(r)}mt(ft).on(qi);function qi(){pe.forEach(async r=>{r.isPanePresented()&&(await r.hide(),r.destroy())}),pe.length=0}const Ui={class:"tw-flex tw-flex-col tw-overflow-hidden tw-h-full"},Wi={class:"cupertino-pane-header bordered-bottom"},Xi=["disabled"],ji={key:0},Ki=l("i",{class:"fas fa-arrow-down"},null,-1),Zi=[Ki],Ji={key:1},Gi=l("i",{class:"fas fa-times"},null,-1),Qi=[Gi],en={class:"bold"},tn=["disabled"],sn=x({__name:"CupertinoPane",props:{name:{},title:{},fullHeight:{type:Boolean},disabled:{type:Boolean},isWidgetMode:{type:Boolean}},emits:["close","submit"],setup(r,{expose:e,emit:t}){const s=r,i=D(null);let n,a,c;$e(()=>{p()});async function p(){if(i.value){n=Array.from(document.querySelectorAll(".cupertino-pane-wrapper")).length,a=i.value.offsetHeight;const b={initialBreak:"top",breaks:f(),backdrop:!0,backdropOpacity:.4,showDraggable:!1,bottomClose:!0,dragBy:[`.cupertino-${s.name} .cupertino-pane-header`],buttonDestroy:!1,cssClass:`cupertino-${s.name} v-app`};c=new Yi(i.value,b),zi(c),c.on("onTransitionStart",()=>{c.wrapperEl.style.zIndex=String(1e3+n)}),c.on("onWillPresent",()=>{document.documentElement.classList.add("modal-open")}),c.on("onDidDismiss",()=>{n===0&&document.documentElement.classList.remove("modal-open"),t("close")}),gt(window.document.documentElement,h),await c.present({animate:!0})}}async function d(){c&&c.destroy({animate:!0})}function h(){c&&(c.updateScreenHeights(),c.setBreakpoints(f()))}function f(){const b=window.innerHeight-10*(n+1),m=s.fullHeight||a>b?b:a;return{top:{enabled:!0,height:m-(s.isWidgetMode?48:0),bounce:!1},middle:{enabled:!1,height:m/2,bounce:!1},bottom:{enabled:!0,height:0,bounce:!1}}}return e({close:()=>d()}),(b,m)=>(o(),u("div",{ref_key:"cupertinoRef",ref:i,class:"cupertino-pane"},[l("div",Ui,[l("div",Wi,[l("button",{class:"button circle light-gray",disabled:b.disabled,onClick:d},[s.isWidgetMode?(o(),u("span",ji,Zi)):(o(),u("span",Ji,Qi))],8,Xi),l("div",en,g(s.title),1),M(b.$slots,"submitButton",{},()=>[l("button",{class:"button circle tw-opacity-0",disabled:b.disabled,onClick:m[0]||(m[0]=U(C=>t("submit"),["prevent"]))},null,8,tn)])]),l("div",{class:z(["cupertino-pane-inner",{"cupertino-pane-inner--disabled":b.disabled}])},[M(b.$slots,"default")],2)])],512))}});const st=x({__name:"CupertinoProvider",props:{title:{},fullHeight:{type:Boolean},show:{type:Boolean}},emits:["close","submit"],setup(r,{expose:e,emit:t}){const s=r,i=D(!1),n=bt(6),a=D(null);return ke(()=>{i.value=!!s.show}),e({show:()=>{i.value=!0},close:()=>{var c;(c=a.value)==null||c.close()}}),(c,p)=>(o(),u(V,null,[M(c.$slots,"toggler",{show:()=>i.value=!0,cupertinoId:E(n)}),(o(),P(yt,{to:"body"},[i.value?(o(),P(sn,Ee({key:0,ref_key:"cupertinoPaneRef",ref:a,name:E(n),"is-widget-mode":c.$route.meta.isWidgetMode},s,{onSubmit:p[0]||(p[0]=()=>{t("submit")}),onClose:p[1]||(p[1]=()=>{t("close"),i.value=!1})}),{submitButton:v(()=>[M(c.$slots,"submitButton")]),default:v(()=>[M(c.$slots,"default")]),_:3},16,["name","is-widget-mode"])):k("",!0)]))],64))}}),nn=r=>(te("data-v-1f601cc1"),r=r(),se(),r),an={class:"tw-py-4"},on=["onClick"],ln=["src"],rn={class:"item__name"},cn={key:0,class:"item__field"},dn={key:1,class:"item__field"},un={key:2,class:"item__field"},hn={key:1,class:"tw-text-center tw-py-3 gray"},pn={class:"tw-h-[5px]"},vn={class:"tw-text-center tw-py-3 tw-h-2"},mn=nn(()=>l("i",{class:"spinner custom-p-12"},null,-1)),fn=[mn],gn=x({__name:"DealInfoSelectParticipantPane",props:{dealId:{},roleId:{},existsParticipantsIds:{},onCancel:{type:Function},isNew:{type:Boolean},model:{},isFetchingDelete:{},isFetchingDone:{},isChange:{},isResponsible:{},errorText:{},clearModel:{type:Function},upsertParticipantRequest:{type:Function},deleteParticipantRequest:{type:Function},updateModelContact:{type:Function}},setup(r,{expose:e}){const t=r,s=D(null);e({show:()=>{var n;(n=s.value)==null||n.show()},close:()=>{i()}});function i(){var n;(n=s.value)==null||n.close()}return(n,a)=>(o(),P(st,{ref_key:"cupertinoProviderRef",ref:s,title:n.$t(t.roleId==="CLIENT"?"customerSelection":"performerSelection"),"full-height":!0},{default:v(()=>[(o(),P(ve(t.roleId==="CLIENT"?Qe:et),{"deal-id":n.dealId,contact:n.model.value.contact,"exclude-ids":t.existsParticipantsIds,"hide-clear":!0,"with-fields":["company"],"input-class":"small",onUpdate:n.updateModelContact},{items:v(({items:c,onSelectItem:p,isFetching:d,interseptionObserver:h})=>[l("div",an,[c!=null&&c.length?(o(),P(ue,{key:0},{default:v(()=>[(o(!0),u(V,null,ee(c,f=>(o(),P(le,{key:f.id},{default:v(()=>[l("a",{class:"item",onClick:U(b=>{p(f),i()},["prevent"])},[n.$slots.item?M(n.$slots,"item",{key:0,item:f},void 0,!0):(o(),u(V,{key:1},[l("img",{class:"userpic userpic32",src:f.userpic},null,8,ln),l("div",null,[l("div",rn,g(f.name),1),f.company?(o(),u("div",cn,g(f.company),1)):k("",!0),f.phone?(o(),u("div",dn,g(f.phone),1)):k("",!0),f.email?(o(),u("div",un,g(f.email),1)):k("",!0)])],64))],8,on)]),_:2},1024))),128))]),_:2},1024)):d?k("",!0):(o(),u("div",hn,g(n.$t("notFound")),1)),J(l("div",pn,null,512),[[He,!d],[E(Nt),([{isIntersecting:f}])=>{f&&h()}]]),l("div",vn,[J(l("span",null,fn,512),[[He,d]])])])]),_:3},40,["deal-id","contact","exclude-ids","onUpdate"]))]),_:3},8,["title"]))}});const bn=X(gn,[["__scopeId","data-v-1f601cc1"]]),yn={class:"switch-with-text"},kn=["id","checked"],_n=l("span",{class:"switch-toggle"},null,-1),wn=["for"],it=x({__name:"SwitchToggle",props:{modelValue:{type:Boolean},size:{}},emits:["update:modelValue"],setup(r,{emit:e}){const t=r,s=kt(),i=N(()=>`switch-${s==null?void 0:s.uid}`);return(n,a)=>(o(),u("div",yn,[l("span",{class:z(["switch",{"is-active":t.modelValue},t.size||""]),onClick:a[0]||(a[0]=c=>e("update:modelValue",!t.modelValue))},[l("input",{id:i.value,type:"checkbox",checked:t.modelValue},null,8,kn),_n],2),l("label",{for:i.value},[t.modelValue?M(n.$slots,"activeText",{key:0}):M(n.$slots,"inactiveText",{key:1}),M(n.$slots,"default")],8,wn)]))}}),En={class:"tw-flex tw-flex-col tw-gap-5 tw-w-full"},$n={class:"small"},Cn=l("i",{class:"fas fa-times"},null,-1),Sn={key:2,class:"state-error-hint"},Pn=l("i",{class:"fas fa-check"},null,-1),Bn=x({__name:"DealInfoParticipantEditMobile",props:{dealId:{},roleId:{},existsParticipantsIds:{},onCancel:{type:Function},isNew:{type:Boolean},model:{},isFetchingDelete:{},isFetchingDone:{},isChange:{},isResponsible:{},errorText:{},clearModel:{type:Function},upsertParticipantRequest:{type:Function},deleteParticipantRequest:{type:Function},updateModelContact:{type:Function}},setup(r){const e=r,t=D(null),s=D(null);return $e(()=>{var i;e.isNew&&((i=s.value)==null||i.show())}),(i,n)=>(o(),u(V,null,[$(bn,Ee({ref_key:"selectParticipantPaneRef",ref:s},e,{onClose:n[0]||(n[0]=a=>!e.model.value.contact.id&&e.onCancel())}),null,16),$(st,{ref_key:"editPaneRef",ref:t,show:!!e.model.value.contact.id,title:i.$t(e.roleId==="CLIENT"?"customer":"performer"),"full-height":!0,onClose:n[6]||(n[6]=a=>e.onCancel())},{submitButton:v(()=>[$(he,{"is-fetching":i.isFetchingDone.value,disabled:!i.model.value.contact.id||!i.isChange.value,circle:!0,onClick:n[5]||(n[5]=a=>i.upsertParticipantRequest(()=>{var c;return(c=t.value)==null?void 0:c.close()}))},{default:v(()=>[Pn]),_:1},8,["is-fetching","disabled"])]),default:v(()=>[l("div",En,[$(Bi,{user:i.model.value.contact,placeholder:i.$t("search"),readonly:"",onFocus:n[1]||(n[1]=a=>{var c;return(c=s.value)==null?void 0:c.show()})},null,8,["user","placeholder"]),$(tt,{modelValue:i.model.value.label,"onUpdate:modelValue":n[2]||(n[2]=a=>i.model.value.label=a),scope:e.roleId,placeholder:i.$t("role"),width:"320px"},null,8,["modelValue","scope","placeholder"]),e.roleId==="USER"?(o(),P(it,{key:0,modelValue:i.isResponsible.value,"onUpdate:modelValue":n[3]||(n[3]=a=>i.isResponsible.value=a),size:"small"},{default:v(()=>[l("div",$n,g(i.$t("responsibleByDeal")),1)]),_:1},8,["modelValue"])):k("",!0),i.isNew?k("",!0):(o(),P(he,{key:1,bg:"light-gray","is-fetching":i.isFetchingDelete.value,onClick:n[4]||(n[4]=a=>i.deleteParticipantRequest(()=>{var c;return(c=t.value)==null?void 0:c.close()}))},{default:v(()=>[Cn,I(" "+g(i.$t("removeFromDeal")),1)]),_:1},8,["is-fetching"])),i.errorText.value?(o(),u("div",Sn,g(i.errorText.value),1)):k("",!0)])]),_:1},8,["show","title"])],64))}}),Dn={class:"participantEdit"},Tn={class:"tw-flex tw-gap-x-1"},xn={class:"small"},On={class:"tw-flex tw-gap-x-2 small tw-mt-2"},In={key:1,class:"state-error-hint"},Fn=x({__name:"DealInfoParticipantEditDesktop",props:{dealId:{},roleId:{},existsParticipantsIds:{},onCancel:{type:Function},isNew:{type:Boolean},model:{},isFetchingDelete:{},isFetchingDone:{},isChange:{},isResponsible:{},errorText:{},clearModel:{type:Function},upsertParticipantRequest:{type:Function},deleteParticipantRequest:{type:Function},updateModelContact:{type:Function}},setup(r){const e=r;return(t,s)=>(o(),u("div",Dn,[l("div",Tn,[(o(),P(ve(e.roleId==="CLIENT"?Qe:et),{"deal-id":t.dealId,contact:t.model.value.contact,"exclude-ids":e.existsParticipantsIds,"hide-clear":!t.isNew,"input-class":"small",class:"width-60",onUpdate:t.updateModelContact,onClear:t.clearModel},null,40,["deal-id","contact","exclude-ids","hide-clear","onUpdate","onClear"])),$(tt,{modelValue:t.model.value.label,"onUpdate:modelValue":s[0]||(s[0]=i=>t.model.value.label=i),scope:e.roleId,placeholder:t.$t("role"),right:"",class:"width-40","input-class":"small"},null,8,["modelValue","scope","placeholder"])]),e.roleId==="USER"?(o(),P(it,{key:0,modelValue:t.isResponsible.value,"onUpdate:modelValue":s[1]||(s[1]=i=>t.isResponsible.value=i),size:"smaller"},{default:v(()=>[l("div",xn,g(t.$t("responsibleByDeal")),1)]),_:1},8,["modelValue"])):k("",!0),l("div",On,[$(he,{"is-fetching":t.isFetchingDone.value,disabled:!t.model.value.contact.id||!t.isChange.value,onClick:t.upsertParticipantRequest},{default:v(()=>[I(g(t.$t("done")),1)]),_:1},8,["is-fetching","disabled","onClick"]),l("button",{class:"button light-gray",onClick:s[2]||(s[2]=i=>e.onCancel())},g(t.$t("cancel")),1),t.isNew?k("",!0):(o(),P(re,{key:0,icon:t.isFetchingDelete.value?"spinner":"times",onClick:t.deleteParticipantRequest},{default:v(()=>[I(g(t.$t("removeFromDeal")),1)]),_:1},8,["icon","onClick"]))]),t.errorText.value?(o(),u("div",In,g(t.errorText.value),1)):k("",!0)]))}});const Hn=X(Fn,[["__scopeId","data-v-58694f29"]]),qe=x({__name:"DealInfoParticipantEdit",props:{participant:{},dealId:{},roleId:{},existsParticipantsIds:{},isFirstAdd:{type:Boolean},isResponsible:{type:Boolean},onUpsert:{type:Function},onDelete:{type:Function},onUpdateResponsible:{type:Function},onCancel:{type:Function}},setup(r){const e=r,t=we(Se),s=G(),i=D({label:null,contact:h()});e.participant&&(i.value=_t(e.participant));const n=D(!1),a=D(!1),c=D(""),p=D(!!e.isFirstAdd||!!e.isResponsible),d=N(()=>!e.participant&&!!i.value.contact.id||e.participant&&JSON.stringify(i.value)!==JSON.stringify(e.participant)||e.isResponsible!==p.value);function h(){return{id:0,name:"",userpic:""}}function f(y){i.value.contact={...i.value.contact,id:y.id,name:y.name,userpic:y.userpic}}function b(){i.value.contact=h()}async function m(y){var B;a.value=!0;const T=e.participant&&i.value.contact.id!==e.participant.contact.id?e.participant.contact.id:void 0,S={contact_id:i.value.contact.id,role_id:e.roleId,replace_contact_id:T,label:i.value.label||"",is_responsible:p.value},w=s.upsertParticipant(S);await w.execute();const{response:Y,error:F,data:H}=w;if((B=Y.value)!=null&&B.ok&&H.value){typeof y=="function"&&y();let R;"contact"in H.value?R=H.value.contact:(R=H.value.user,"user_contact_id"in H.value?e.onUpdateResponsible(H.value.user_contact_id):e.isResponsible&&e.onUpdateResponsible(0)),R.contact.userpic=i.value.contact.userpic,e.onUpsert(R)}else c.value=F.value;a.value=!1}async function C(y){var S,w;if(!e.participant)return;n.value=!0;const T=s.deleteParticipant({contact_id:e.participant.contact.id,role_id:e.roleId});await T.execute(),n.value=!1,(S=T.response.value)!=null&&S.ok?(typeof y=="function"&&y(),e.isResponsible&&e.onUpdateResponsible(0),(w=e.onDelete)==null||w.call(null)):c.value=T.error.value}const _={dealId:e.dealId,roleId:e.roleId,existsParticipantsIds:e.existsParticipantsIds,onCancel:e.onCancel,isNew:!e.participant,model:i,isFetchingDelete:n,isFetchingDone:a,isChange:d,isResponsible:p,errorText:c,clearModel:b,upsertParticipantRequest:m,deleteParticipantRequest:C,updateModelContact:f};return(y,T)=>(o(),P(ve(E(t)&&y.$route.meta.menuItemType!=="frame"?Bn:Hn),fe(ge(_)),null,16))}}),Mn={key:0},Rn={key:1,class:"gray tw-text-sm"},Ue=x({__name:"DealInfoParticipants",props:{label:{},emptyMessage:{},targetProp:{},modelValue:{}},emits:["update:modelValue"],setup(r,{emit:e}){const t=r,s=D(!1),i=N(()=>t.modelValue[t.targetProp]),n=N(()=>t.targetProp==="contacts"?"CLIENT":"USER"),a=N(()=>t.modelValue.users.map(b=>b.contact.id).concat(t.modelValue.contacts.map(b=>b.contact.id)));function c(b){const m=[...i.value];m.unshift(b),f(m),s.value=!1}function p(b,m){const C=[...i.value];C[m]=b,f(C)}function d(b){const m=[...i.value];m.splice(b,1),f(m)}function h(b){setTimeout(()=>{e("update:modelValue",{...t.modelValue,user_contact_id:b})})}function f(b){let m=t.modelValue.contact_id;n.value==="CLIENT"&&(b.length===1?m=b[0].contact.id:b.length===0&&(m=0)),e("update:modelValue",{...t.modelValue,[t.targetProp]:b,contact_id:m}),Je()}return(b,m)=>(o(),P(oe,{label:t.label,"use-add":"",space:"4",onAdd:m[1]||(m[1]=C=>s.value=!0)},{default:v(()=>[s.value?(o(),u("div",Mn,[$(qe,{"role-id":n.value,"deal-id":t.modelValue.id,"exists-participants-ids":a.value,"is-first-add":!i.value.length,onUpsert:c,onCancel:m[0]||(m[0]=C=>s.value=!1),onUpdateResponsible:h},null,8,["role-id","deal-id","exists-participants-ids","is-first-add"])])):k("",!0),$(ie,{space:n.value==="CLIENT"?"6":"4"},{default:v(()=>[i.value.length?(o(!0),u(V,{key:0},ee(i.value,(C,_)=>(o(),P(_i,{key:C.contact.id,contact:C,"is-responsible":n.value==="USER"&&C.contact.id===t.modelValue.user_contact_id},{edit:v(({participant:y,hide:T,isResponsible:S})=>[$(qe,{participant:y,"role-id":n.value,"deal-id":t.modelValue.id,"is-responsible":S,"exists-participants-ids":a.value,onUpsert:w=>{p(w,_),T()},onDelete:w=>{d(_),T()},onCancel:w=>T(),onUpdateResponsible:h},null,8,["participant","role-id","deal-id","is-responsible","exists-participants-ids","onUpsert","onDelete","onCancel"])]),_:2},1032,["contact","is-responsible"]))),128)):(o(),u("div",Rn,g(t.emptyMessage),1))]),_:1},8,["space"])]),_:1},8,["label"]))}}),Pe=x({__name:"InlineEdit",props:{editing:{type:Boolean},useInputClickOutside:{type:Boolean},disableEdit:{type:Boolean}},emits:["editing","save","cancel"],setup(r,{emit:e}){const t=r,s=D(null),i=D(!1);Ce(()=>t.editing,d=>{d?a():p()}),t.useInputClickOutside&&wt(s,()=>{c()});function n(d){d instanceof Element&&(s.value=d)}Me(document,"keyup",d=>{d.type==="keyup"&&d.key==="Escape"&&p()});function a(){t.disableEdit||(i.value=!0,e("editing"),Et(()=>{const d=s.value;d.focus(),Me(d,"keyup",h=>{i.value&&h.type==="keyup"&&h.key==="Enter"&&c()})}))}function c(){e("save")}function p(){i.value=!1,s.value=null,e("cancel")}return(d,h)=>i.value?M(d.$slots,"edit",{key:0,setInputRef:n,cancel:p,save:()=>c()}):M(d.$slots,"view",{key:1,edit:a,canEdit:!t.disableEdit})}}),Nn=r=>(te("data-v-fb36c4ae"),r=r(),se(),r),An={class:"date-term"},Vn=["title"],Ln={key:0,class:"tw-mx-1"},Yn={class:"tw-flex-auto tw-w-0"},zn={key:0,class:"gray"},qn={key:0,class:"tw-truncate"},Un={key:1,class:"tw-ml-1 tw-tracking-widest"},Wn={class:"date-term__edit"},Xn=["disabled"],jn={key:0,class:"state-error-hint"},Kn={key:0,class:"icon tw-ml-1"},Zn=Nn(()=>l("i",{class:"fas fa-spinner wa-animation-spin"},null,-1)),Jn=[Zn],Gn=x({__name:"DealInfoFieldDateTerm",props:{deal:{},noEdit:{type:Boolean}},setup(r){const e=r,t=D(!1),s=D(!1),i=D(null),n=D(),a=N(()=>Yt(e.deal.create_datetime)),c=N(()=>e.deal.rights.can_edit),p=N(()=>e.deal.status_id!=="OPEN"),d=N(()=>!!e.deal.expected_date),h=N(()=>!!e.deal.closed_datetime);function f(){n.value=e.deal.expected_date,i.value=null,s.value=!0}async function b(){var _;if(i.value=null,n.value===e.deal.expected_date){s.value=!1;return}t.value=!0;const{ok:m,data:C}=await G().changeExpectedDate(n.value);t.value=!1,m?s.value=!1:i.value=(_=C.error_fields)!=null&&_.length?C.error_fields[0].description:C.error_description}return(m,C)=>(o(),u("div",An,[l("span",{title:m.$t("createdAt")},g(a.value),9,Vn),d.value||c.value?(o(),u("span",Ln,"—")):k("",!0),l("div",Yn,[p.value?(o(),u(V,{key:0},[h.value?(o(),u("span",zn,[I(g(m.$t("closedAt"))+" ",1),l("strong",null,g(E(Ae)(e.deal.closed_datetime).format("L")),1)])):k("",!0)],64)):(o(),P(Pe,{key:1,"use-input-click-outside":"",editing:s.value,onSave:b,onCancel:C[2]||(C[2]=_=>s.value=!1)},{view:v(({canEdit:_})=>[l("div",{class:z([{"hover:tw-bg-waEditable":!e.noEdit&&_},"tw-w-fit"]),onClick:C[0]||(C[0]=y=>!e.noEdit&&f())},[d.value?J((o(),u("div",qn,[I(g(E(Ae)(e.deal.expected_date).format("L")),1)])),[[E(ye),m.$t("expectedCloseDate"),void 0,{"top-start":!0,550:!0}]]):J((o(),u("div",Un,[I(" ..............? ")])),[[E(ye),m.$t("expectedCloseDate"),void 0,{"top-start":!0,550:!0}]])],2)]),edit:v(({setInputRef:_})=>[l("div",Wn,[l("div",null,[J(l("input",{ref:y=>_(y),"onUpdate:modelValue":C[1]||(C[1]=y=>n.value=y),disabled:t.value,class:z([{"state-error":i.value},"date-term__edit-input"]),type:"date"},null,10,Xn),[[je,n.value]]),i.value?(o(),u("div",jn,g(i.value),1)):k("",!0)]),t.value?(o(),u("span",Kn,Jn)):k("",!0)])]),_:1},8,["editing"]))])]))}});const Qn=X(Gn,[["__scopeId","data-v-fb36c4ae"]]),nt=r=>(te("data-v-bcb94173"),r=r(),se(),r),ea={key:0,class:"amount"},ta={key:1},sa={key:0,class:"hint break-word"},ia=["href"],na=nt(()=>l("i",{class:"fas fa-external-link-alt fa-sm"},null,-1)),aa={class:"amount__edit"},oa={class:"tw-w-1/2 tw-space-x-1"},la=["disabled","type"],ra={key:0,class:"state-error-hint"},ca={key:0,class:"icon tw-mt-2"},da=nt(()=>l("i",{class:"fas fa-spinner wa-animation-spin"},null,-1)),ua=[da],ha=x({__name:"DealInfoFieldAmount",props:{deal:{},noEdit:{type:Boolean}},setup(r){const e=r,t=we(Se),s=N(()=>t.value||Ct()),i=D(!1),n=D(!1),a=D({amount:"",currency_id:""}),c=D({amount:e.deal.amount,currency_id:e.deal.currency_id}),p=D(),d=N(()=>e.deal.rights.can_edit),h=N(()=>e.deal.status_id!=="OPEN"),f=N(()=>{var S;return!d.value||h.value||!!((S=e.deal.external_id)!=null&&S.startsWith("shop:"))}),b=N(()=>h.value&&(isNaN(e.deal.amount)||!(Math.abs(e.deal.amount)>0))),m=N(()=>{const S=e.deal.currency_id,w=e.deal.amount;return w!==null?zt(S,w):""}),C=N(()=>Lt().isEmptyCurrencies);function _(){T(),c.value={amount:e.deal.amount,currency_id:e.deal.currency_id},p.value={...c.value},n.value=!0}async function y(){var S;if(T(),JSON.stringify(p.value)!==JSON.stringify(c.value)){i.value=!0;const{ok:w,data:Y}=await G().changeAmountAndCurrency(c.value);w?n.value=!1:(S=Y.error_fields)==null||S.forEach(F=>{a.value[F.field]=F.description}),i.value=!1}else setTimeout(()=>n.value=!1)}function T(){a.value.amount="",a.value.currency_id=""}return(S,w)=>{const Y=Xe("i18n-t");return b.value?(o(),u(V,{key:0},[I(g(S.$t("notSpecified")),1)],64)):(o(),P(Pe,{key:1,editing:n.value,"disable-edit":f.value||C.value,onSave:y,onCancel:w[3]||(w[3]=F=>n.value=!1)},{view:v(({canEdit:F})=>[l("div",{class:z({"hover:tw-bg-waEditable":!e.noEdit&&F}),onClick:w[0]||(w[0]=H=>!e.noEdit&&_())},[m.value?(o(),u("div",ea,g(m.value?m.value:S.$t("setEstimatedAmount")),1)):(o(),u("div",ta,g(S.$t("setEstimatedAmount")),1))],2),C.value?(o(),u("div",sa,[$(Y,{keypath:"currenciesNotSetUp"},{default:v(()=>[l("a",{class:z(S.$constant.parentAppDisableRouterClass),href:`${E(Ke).baseUrl}settings/currencies/`,target:"_blank"},[I(g(S.$t("settingsCurrencies"))+" ",1),na],10,ia)]),_:1})])):k("",!0)]),edit:v(({setInputRef:F})=>[J((o(),u("div",aa,[l("span",oa,[J(l("input",{ref:H=>F(H),"onUpdate:modelValue":w[1]||(w[1]=H=>c.value.amount=H),class:z([{"state-error":a.value.amount},"amount__edit-input !tw-text-left"]),disabled:i.value,type:s.value?"text":"number",min:"0",inputmode:"decimal"},null,10,la),[[$t,c.value.amount],[E(qt)]]),a.value.amount?(o(),u("div",ra,g(a.value.amount),1)):k("",!0)]),$(Vt,{modelValue:c.value.currency_id,"onUpdate:modelValue":w[2]||(w[2]=H=>c.value.currency_id=H),"error-message":a.value.currency_id,disabled:i.value,required:""},null,8,["modelValue","error-message","disabled"]),i.value?(o(),u("span",ca,ua)):k("",!0)])),[[E(At),y]])]),_:1},8,["editing","disable-edit"]))}}});const pa=X(ha,[["__scopeId","data-v-bcb94173"]]),va={key:0,class:"text-dark-gray semibold"},ma=l("span",{class:"icon"},[l("i",{class:"fas fa-check text-green"})],-1),fa=["onClick"],ga=x({__name:"CopyToClipboard",props:{text:{}},setup(r){const e=r,t=D(!1);function s(){t.value=!0,navigator.clipboard.writeText(e.text),setTimeout(()=>t.value=!1,1e3)}return(i,n)=>t.value?(o(),u("div",va,[ma,I(" "+g(i.$t("copiedToClipboard")),1)])):(o(),u("div",{key:1,onClick:U(s,["stop"])},[M(i.$slots,"default")],8,fa))}}),ba={class:"deal-info-email"},ya={class:"hint"},ka=x({__name:"DealInfoEmail",props:{email:{}},setup(r){const e=r;return(t,s)=>(o(),u("div",ba,[l("small",null,g(t.$t("saveCorrespondenceWithClientUseEmail")),1),$(ga,{text:e.email,class:"tw-pt-0.5 tw-pb-1"},{default:v(()=>[l("a",{class:"mobile:tw-text-sm",onClick:s[0]||(s[0]=U(()=>{},["prevent"]))},g(e.email),1)]),_:1},8,["text"]),l("span",ya,g(t.$t("addAddressInCCForClient")),1)]))}});const _a=X(ka,[["__scopeId","data-v-8bf88964"]]),wa=["href"],Ea=l("span",{class:"icon"},[l("i",{class:"fas fa-cog"})],-1),$a={class:"label"},Ca=l("span",{class:"count !tw-text-base"},[l("i",{class:"fas fa-external-link-alt !tw-text-xs"})],-1),Sa=x({__name:"DropdownAddCustomFields",props:{fieldList:{},isEmptyBody:{type:Boolean}},setup(r){const e=r;return(t,s)=>(o(),P(Ut,{items:t.fieldList,right:"","enable-correct-top":""},St({title:v(()=>[I(g(t.$t("addField")),1)]),footer:v(()=>[$(ue,null,{default:v(()=>[$(le,null,{default:v(()=>[l("a",{class:z(t.$constant.parentAppDisableRouterClass),href:`${E(Ke).baseUrl}settings/field/`,target:"_blank"},[Ea,l("span",$a,g(t.$t("customizeFields")),1),Ca],10,wa)]),_:1})]),_:1})]),default:v(()=>[$(re,{class:"smaller","icon-color":"var(--deal-sidebar-icon-color)",icon:"plus"},{default:v(()=>[I(g(t.$t("add")),1)]),_:1})]),_:2},[e.isEmptyBody?{name:"empty",fn:v(()=>[I(g(t.$t("noFieldsForAddToDeal")),1)]),key:"0"}:void 0]),1032,["items"]))}}),Pa={class:"deal-info-source"},Ba={class:"tw-flex tw-space-x-2 tw-items-center"},Da={class:"tw-truncate"},Ta={key:0,class:"text-ellipsis"},xa=["href"],Oa=l("i",{class:"fas fa-external-link-alt"},null,-1),Ia=x({__name:"DealInfoFieldSource",props:{source:{}},setup(r){const e=r,t=N(()=>e.source.type==="SHOP"?Ot:e.source.icon_url);return(s,i)=>(o(),u("div",Pa,[l("div",Ba,[t.value?(o(),P(K,{key:0,url:t.value,size:16,"disable-rounded":""},null,8,["url"])):k("",!0),l("span",Da,g(e.source.name),1)]),e.source.form_page_url?(o(),u("div",Ta,[l("a",{target:"_blank",href:e.source.form_page_url},[Oa,I(" "+g(e.source.form_page_url),1)],8,xa)])):k("",!0)]))}}),Fa={class:"cf__label"},Ha={key:0,class:"cf__tooltip"},Ma={class:"cf__value"},Ra=x({__name:"DealInfoCustomFieldRow",props:{skeleton:{type:Boolean},tooltip:{},editable:{type:Boolean}},setup(r){const e=r,t=N(()=>e.tooltip||!e.editable?{gridTemplateColumns:`
        minmax(${e.tooltip?100:110}px, 1fr)
        ${e.tooltip?"minmax(16px, 16px)":""}
        minmax(100px, 3fr)
        ${e.editable?"minmax(16px, 16px)":""}`}:"");return(s,i)=>(o(),u("div",{class:"cf",style:_e([t.value])},[l("div",Fa,[M(s.$slots,"label",{},void 0,!0)]),e.tooltip?(o(),u("div",Ha,[$(Rt,{class:"size-14",content:e.tooltip,"trigger-click":""},null,8,["content"])])):k("",!0),l("div",Ma,[M(s.$slots,"content",{},void 0,!0)]),e.editable?M(s.$slots,"iconEdit",{key:1},void 0,!0):k("",!0)],4))}});const at=X(Ra,[["__scopeId","data-v-72fd3e9b"]]),Na=r=>(te("data-v-ff503f9a"),r=r(),se(),r),Aa={key:0,class:"cf-editing"},Va={key:0,class:"tw-mb-2"},La={class:"cf-editing-buttons"},Ya=["title"],za=Na(()=>l("span",{class:"icon"},[l("i",{class:"fas fa-trash-alt text-red"})],-1)),qa=[za],Ua={key:1,class:"cf-content"},Wa=x({__name:"DealInfoCustomField",props:{fieldExt:{},tooltip:{},editable:{type:Boolean}},emits:["update","remove","removeNewField"],setup(r,{emit:e}){const t=r,s=D({...t.fieldExt}),i=D(s.value.isNew),n=D("update");Ce(()=>t.fieldExt,d=>{d.error?s.value={...s.value,error:d.error,isFetchingSave:d.isFetchingSave,isFetchingRemove:d.isFetchingRemove}:s.value={...d},i.value=!!d.error||s.value.isFetchingSave||d.isFetchingRemove});const a=N(()=>s.value.data!==t.fieldExt.data||n.value==="remove");function c(){s.value.isNew&&e("removeNewField",s.value.id),n.value="update",i.value=!1,s.value={...t.fieldExt}}function p(){if(!a.value&&!s.value.isNew){i.value=!1;return}n.value==="remove"?e("remove",s.value):e("update",s.value)}return(d,h)=>t.fieldExt?(o(),P(at,{key:0,editable:t.editable},{label:v(()=>[I(g(t.fieldExt.name),1)]),content:v(()=>[i.value?(o(),u("div",Aa,[n.value!=="remove"?(o(),u("div",Va,[(o(),P(ve(E(Ht)[s.value.type]),{modelValue:s.value.data,"onUpdate:modelValue":h[0]||(h[0]=f=>s.value.data=f),"error-message":s.value.error,options:(s.value.type==="select"||s.value.type==="radio")&&s.value.option_values,vertical:s.value.type==="radio",required:s.value.is_required,onChange:h[1]||(h[1]=f=>s.value.error=""),onKeydown:[h[2]||(h[2]=Re(U(f=>["string","number","date"].includes(s.value.type)&&p(),["stop"]),["enter"])),Re(U(c,["stop"]),["esc"])]},null,40,["modelValue","error-message","options","vertical","required","onKeydown"]))])):k("",!0),l("div",La,[$(he,{"is-fetching":s.value.isFetchingSave||s.value.isFetchingRemove,disabled:!a.value,onClick:p},{default:v(()=>[I(g(d.$t("done")),1)]),_:1},8,["is-fetching","disabled"]),l("button",{class:"button light-gray",onClick:c},g(d.$t("cancel")),1),n.value!=="remove"&&!s.value.isNew&&s.value.type!=="checkbox"?(o(),u("button",{key:0,class:"button light-gray",title:d.$t("deleteField"),onClick:h[3]||(h[3]=f=>n.value="remove")},qa,8,Ya)):k("",!0)])])):(o(),u("div",Ua,[t.fieldExt.value?(o(),u(V,{key:0},[I(g(t.fieldExt.value),1)],64)):k("",!0)]))]),iconEdit:v(()=>[t.editable&&!i.value?(o(),P(re,{key:0,class:"cf__edit-btn","icon-color":"var(--deal-sidebar-icon-color)",icon:"pen",onClick:h[4]||(h[4]=f=>i.value=!0)})):k("",!0)]),_:1},8,["editable"])):k("",!0)}});const Xa=X(Wa,[["__scopeId","data-v-ff503f9a"]]),ja={class:"deal-info-fields"},Ka={key:0,class:"tw-sticky tw-left-0 tw-text-center tw-py-4"},Za=l("div",{class:"spinner custom-p-16"},null,-1),Ja=[Za],Ga={key:2,class:"gray tw-text-sm"},Qa=x({__name:"DealInfoCustomFields",props:{modelValue:{},source:{}},emits:["update:modelValue"],setup(r,{emit:e}){const t=r,s=G(),i=D(!1),n=D([]),a=D([]),{fields:c,isFetching:p}=de(Wt());$e(()=>{c.value.length?d(c.value):Pt(c,d)});function d(_){if(Array.isArray(_)&&_.length){i.value=!0;const y=_.reduce((S,w)=>({...S,[w.id]:w}),{});n.value=t.modelValue.map(S=>{const w=S.id,Y=y[w],F={id:w,data:S.data,name:S.name,value:S.value,type:Y.type,is_required:!!Y.is_required,error:"",isFetchingSave:!1,isFetchingRemove:!1,isNew:!1};return Y.option_values&&(F.option_values=Y.option_values),F});const T=[];if(Object.keys(y).length)for(const S in y){const w=n.value.findIndex(Y=>Y.id===S)!==-1;T.push(C({id:S,label:y[S].name,clickHandler:()=>f(y[S])},w))}a.value.push(...T.sort((S,w)=>Number(w.lighten)-Number(S.lighten)))}}async function h(_,y){var Y;let T=_.data;y==="delete"?(_.isFetchingRemove=!0,T=null):_.isFetchingSave=!0;const{ok:S,data:w}=await s.basePatchRequest([{field:_.id,value:T}]);if(_.isFetchingRemove=_.isFetchingSave=!1,S){if(w!=="no change"){const F=w.find(H=>H.id===_.id);if(F){if(F.value===null)b(_.id);else{const H=n.value.findIndex(B=>B.id===_.id);n.value[H]={...n.value[H],value:F.value,data:F.data,isNew:!1,error:""}}e("update:modelValue",Object.values(n.value)),Je()}}}else(Y=w==null?void 0:w.error_fields)!=null&&Y.length&&(w==null||w.error_fields.forEach(F=>{const H=n.value.findIndex(B=>B.id===F.field);n.value[H]={...n.value[H],error:F.description}}))}function f(_){const y={id:_.id,name:_.name,is_required:!!_.is_required,type:_.type,data:"",value:"",error:"",isFetchingSave:!1,isFetchingRemove:!1,isNew:!0};(_.type==="radio"||_.type==="select")&&(y.option_values=_.option_values),n.value.unshift(y),m(y.id,!0)}function b(_){const y=n.value.findIndex(T=>T.id===_);y!==-1&&(n.value.splice(y,1),m(_,!1))}function m(_,y){a.value=a.value.map(T=>T.id===_?C(T,y):T).sort((T,S)=>Number(S.lighten)-Number(T.lighten))}function C(_,y){return{..._,classIcon:y?"fas fa-check":"fas fa-plus-circle",lighten:y,disableClick:y}}return(_,y)=>(o(),u("div",ja,[$(oe,{label:_.$t("addtnlInfo"),space:"4"},{buttonAdd:v(()=>[$(Sa,{"field-list":a.value,"is-empty-body":!i.value},null,8,["field-list","is-empty-body"])]),default:v(()=>{var T;return[E(p)?(o(),u("div",Ka,Ja)):(o(),P(ie,{key:1,space:"4"},{default:v(()=>[t.source?(o(),P(at,{key:0},{label:v(()=>[I(g(_.$t("source")),1)]),content:v(()=>[$(Ia,{source:t.source},null,8,["source"])]),_:1})):k("",!0),(o(!0),u(V,null,ee(n.value,S=>(o(),P(Xa,{key:S.id,"field-ext":S,editable:"",onUpdate:y[0]||(y[0]=w=>h(w,"update")),onRemove:y[1]||(y[1]=w=>h(w,"delete")),onRemoveNewField:y[2]||(y[2]=w=>b(w))},null,8,["field-ext"]))),128))]),_:1})),(T=_.modelValue)!=null&&T.length?k("",!0):(o(),u("div",Ga,g(_.$t("fieldsNotAdded")),1))]}),_:1},8,["label"])]))}}),eo=l("span",{class:"icon size-64"},[l("i",{class:"fas fa-low-vision"})],-1),Vo=x({__name:"DealInfo",setup(r){const{deal:e,statusCode:t}=de(G());return(s,i)=>E(e)?(o(),u(V,{key:0},[$(ie,{space:"4",class:"tw-mb-4 !tw-flex-none"},{default:v(()=>{var n;return[s.$slots.top?M(s.$slots,"top",{key:0,deal:E(e)}):k("",!0),s.$slots.description&&((n=E(e).description_plain)!=null&&n.trim())?(o(),P(oe,{key:1,label:s.$t("dealDescr")},{default:v(()=>[M(s.$slots,"description",{deal:E(e)})]),_:3},8,["label"])):k("",!0),$(oe,{label:s.$t("estimatedAmount"),class:"tw-min-h-[2rem]"},{default:v(()=>[$(pa,{deal:E(e)},null,8,["deal"])]),_:1},8,["label"]),$(oe,{label:s.$t("dealTerm"),class:"tw-min-h-[2rem]"},{default:v(()=>[$(Qn,{deal:E(e)},null,8,["deal"])]),_:1},8,["label"])]}),_:3}),$(ie,{space:"6",class:"!tw-flex-none"},{default:v(()=>{var n;return[$(Ue,{modelValue:E(e),"onUpdate:modelValue":i[0]||(i[0]=a=>be(e)?e.value=a:null),"target-prop":"contacts",label:s.$t("customers"),"empty-message":s.$t("noCustomer")},null,8,["modelValue","label","empty-message"]),$(Ue,{modelValue:E(e),"onUpdate:modelValue":i[1]||(i[1]=a=>be(e)?e.value=a:null),"target-prop":"users",label:s.$t("performers"),"empty-message":s.$t("responsibleNotAssigned")},null,8,["modelValue","label","empty-message"]),E(e).email?(o(),P(_a,{key:0,email:E(e).email},null,8,["email"])):k("",!0),$(ie,{space:"2",class:"!tw-flex-none"},{default:v(()=>[$(Zs,{modelValue:E(e).tags,"onUpdate:modelValue":i[2]||(i[2]=a=>E(e).tags=a),"deal-id":E(e).id},null,8,["modelValue","deal-id"])]),_:1}),(n=E(e).aux_blocks)!=null&&n.length?(o(),P(ie,{key:1,space:"6",class:"!tw-flex-none"},{default:v(()=>[(o(!0),u(V,null,ee(E(e).aux_blocks,a=>(o(),P(oe,{key:a.id,label:a.title,space:"4"},{default:v(()=>[$(Xt,{"content-outside-tab-body":!0,"force-resize":!0,tab:a},null,8,["tab"])]),_:2},1032,["label"]))),128))]),_:1})):k("",!0),$(Qa,{modelValue:E(e).fields,"onUpdate:modelValue":i[3]||(i[3]=a=>E(e).fields=a),source:E(e).source},null,8,["modelValue","source"]),s.$slots.bottom?M(s.$slots,"bottom",{key:2,deal:E(e)}):k("",!0)]}),_:3})],64)):[403,404].includes(Number(E(t)))?(o(),P(Kt,{key:1,message:""},{default:v(()=>[eo]),_:1})):(o(),P(jt,{key:2,"row-height":"2rem"}))}});const to=r=>(te("data-v-4160e4ef"),r=r(),se(),r),so={class:"tw-inline-block tw-w-full"},io={class:z(["tw-relative mobile:tw-text-xs"])},no=["disabled"],ao={key:0,class:"icon tw-absolute tw-top-1/2 -tw-translate-y-1/2 tw-right-4"},oo=to(()=>l("i",{class:"fas fa-spinner wa-animation-spin"},null,-1)),lo=[oo],ro={key:1,class:"state-error-hint"},co={key:1,class:"skeleton"},uo=x({__name:"DealHeaderName",props:{editing:{type:Boolean},dealId:{},dealName:{},canEdit:{type:Boolean},isClosed:{type:Boolean},disableCenterMobile:{type:Boolean}},emits:["editing"],setup(r,{emit:e}){const t=r,s=D(!1),i=D(!1),n=D(""),a=D({name:""}),{validation:c,validate:p}=Zt(a,{name:"required"});Ce(()=>t.editing,b=>{!!b!==s.value&&(b?d():s.value=!1)});function d(){a.value.name=t.dealName||"",n.value="",f(!0)}async function h(){var C;if(c.value.name.error)return;if(n.value="",a.value.name===t.dealName){f(!1);return}i.value=!0;const{ok:b,data:m}=await G().changeName(a.value.name);i.value=!1,b?f(!1):n.value=(C=m.error_fields)!=null&&C.length?m.error_fields[0].description:m.error_description}function f(b){s.value=b,e("editing",b)}return(b,m)=>t.dealId?(o(),P(Pe,{key:0,"use-input-click-outside":"",editing:s.value,"disable-edit":!t.canEdit,onSave:h,onCancel:m[2]||(m[2]=C=>f(!1))},{view:v(({canEdit:C})=>[l("span",so,[l("h1",{class:z(["deal-name mobile:tw-text-xl",{"deal-name--close":t.isClosed,"hover:tw-bg-waEditable":C,"mobile:tw-text-center":!t.disableCenterMobile}]),onClick:d},g(t.dealName||" "),3)])]),edit:v(({setInputRef:C})=>[l("div",io,[J(l("input",{ref:_=>C(_),"onUpdate:modelValue":m[0]||(m[0]=_=>a.value.name=_),disabled:i.value,type:"text",class:z(["deal-name__input border-none",{"state-error":n.value||E(c).name.error}]),required:"",onKeyup:m[1]||(m[1]=(..._)=>E(p)&&E(p)(..._))},null,42,no),[[je,a.value.name]]),i.value?(o(),u("span",ao,lo)):k("",!0),n.value||E(c).name.errorMessage?(o(),u("div",ro,g(n.value||E(c).name.errorMessage),1)):k("",!0)])]),_:1},8,["editing","disable-edit"])):(o(),u("div",co,[l("span",{class:z(["skeleton-line tw-max-w-sm !tw-h-9",{"mobile:tw-mx-auto":!t.disableCenterMobile}])},null,2)]))}});const Lo=X(uo,[["__scopeId","data-v-4160e4ef"]]),Yo=x({__name:"DealHeaderButtonReopen",setup(r){const e=Ge(Bt(G(),"deal")),t=D(!1);async function s(){t.value=!0,await e.reopenDeal(),t.value=!1}return(i,n)=>(o(),P(re,{icon:t.value?"spinner":"undo",class:"tw-mt-1 smallest","color-class":"tw-text-waAccent",onClick:U(s,["prevent"])},{default:v(()=>[I(g(i.$t("reopenDeal")),1)]),_:1},8,["icon","onClick"]))}});export{Lo as D,Yo as _,Ao as a,Vo as b,st as c,Ye as d};
