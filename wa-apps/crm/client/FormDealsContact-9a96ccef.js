import{d as x,h as p,O as y,l as F,R as A,V as _,au as B,ag as T,o as n,c as v,a as s,p as h,b as N,w,A as O,e as b,u as i,i as D,k as E,v as L,av as M,aw as $,s as R,x as V,ae as P,_ as Y}from"./main-f4d713e0.js";import{v as j}from"./index-c6546edf.js";import{_ as z}from"./WaDialogOpener.vue_vue_type_script_setup_true_lang-357af123.js";import U from"./FormDealAdd-381a61a2.js";import{S as q}from"./SkeletonList-bb6bf037.js";import{_ as G}from"./DealsListTable.vue_vue_type_style_index_0_lang-55a9b3ee.js";import"./fields-9557e3ab.js";import"./FieldCheckbox-24639e50.js";import"./FieldSelect-9c9c8fcb.js";import"./CustomColumn-97fca79e.js";import"./FormContactUpdateInfo.vue_vue_type_script_setup_true_lang-6f44131b.js";import"./SortableList.vue_vue_type_script_setup_true_lang-61a52d30.js";import"./useSortable-4ffbbe69.js";import"./InputWithContacts.vue_vue_type_script_setup_true_lang-19bb7dd6.js";import"./UserPic-6f399f83.js";import"./DropDown-a7251113.js";import"./InputWithPerformers.vue_vue_type_script_setup_true_lang-99fd8abe.js";import"./recentContacts-f75fb9c0.js";import"./vTooltip-95186f83.js";import"./dayjs-72e0aed2.js";import"./index-00848a90.js";import"./emit-2e4d7646.js";import"./WaSpinner-012571e7.js";import"./TextAreaAutoresize-cd07b9ca.js";import"./DropDownButton-3208b591.js";import"./ButtonSubmit-3daf0653.js";import"./DealsItemResponsible.vue_vue_type_style_index_0_lang-029ec831.js";import"./ChipsList-110d0801.js";import"./currency-format-e3b07f87.js";import"./ContactsListItemAction.vue_vue_type_style_index_0_lang-5c93be27.js";import"./date-adb8c64a.js";import"./EmptyList-3026908b.js";const C=a=>(R("data-v-46071ffd"),a=a(),V(),a),H={class:"form-deals-contact tw-p-4"},J=["onClick"],K=C(()=>s("span",{class:"icon tw-mr-1"},[s("i",{class:"fas fa-plus-circle"})],-1)),Q={class:"tw-mt-3 tw-h-full"},W={class:"tw-sticky tw-left-0 tw-text-center tw-py-4"},X=C(()=>s("div",{class:"spinner tw-p-5 tw-mx-auto"},null,-1)),Z=[X],m=20,tt=x({__name:"FormDealsContact",props:{contactId:{}},setup(a){const u=a,I=["id","stage_id","name","states","create_datetime","amount","user"],e=p(null),r=p(0),o=p({contact_id:u.contactId,limit:m,offset:0}),{data:g,isFetching:S,execute:f}=y(F(()=>`crm.deal.list?${P.stringify(o.value)}`),{refetch:!0}).get().json();f(),A(g,t=>{t&&(t.params.offset>0?e.value=[...e.value||[],...t.data]:e.value=t.data,r.value=t.params.total_count,o.value.offset=t.params.offset)}),_(M).on(t=>{e.value&&B(t,e.value)}),_($).on(()=>{d()});function k(){o.value.offset+m>=r.value||(o.value.offset+=m)}function d(){e.value=null,o.value.offset===0?f():o.value.offset=0}const c=T();return c.fetch(),(t,et)=>(n(),v("div",H,[s("h3",null,h(t.$t("Deals")),1),N(z,{component:U,"component-props":{contactId:u.contactId,disableNavigateToDeal:!0,onAdded:d}},{default:w(({open:l})=>[s("button",{class:"button",onClick:b(l,["prevent"])},[K,O(" "+h(t.$t("newDeal")),1)],8,J)]),_:1},8,["component-props"]),s("div",Q,[i(c).funnelsMap&&e.value?(n(),D(G,{key:0,deals:e.value,"use-columns-ids":I,"navigate-route-name":"dealByContactFrame","funnels-map":i(c).funnelsMap},{lazy:w(()=>[E((n(),v("div",W,Z)),[[L,e.value.length<r.value],[i(j),([{isIntersecting:l}])=>{l&&!i(S)&&k()}]])]),_:1},8,["deals","funnels-map"])):(n(),D(q,{key:1,"row-height":"100px"}))])]))}});const Et=Y(tt,[["__scopeId","data-v-46071ffd"]]);export{Et as default};
