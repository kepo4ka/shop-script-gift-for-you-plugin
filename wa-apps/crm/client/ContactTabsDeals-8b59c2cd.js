import{d as T,h as p,P as B,O as $,l as x,R as N,V as A,ag as E,u as o,o as n,i as M,c,a9 as L,b as m,w as r,A as h,p as w,e as y,N as P,a as g,k as V,v as z,W as F,ae as O,s as R,x as W,_ as j}from"./main-f4d713e0.js";import{v as U}from"./index-c6546edf.js";import{I as b}from"./IconButton-ac0bf9c2.js";import{_ as q}from"./DealsListTable.vue_vue_type_style_index_0_lang-55a9b3ee.js";import{S as G}from"./SkeletonList-bb6bf037.js";import"./DealsItemResponsible.vue_vue_type_style_index_0_lang-029ec831.js";import"./vTooltip-95186f83.js";import"./ChipsList-110d0801.js";import"./UserPic-6f399f83.js";import"./index-00848a90.js";import"./dayjs-72e0aed2.js";import"./currency-format-e3b07f87.js";import"./ContactsListItemAction.vue_vue_type_style_index_0_lang-5c93be27.js";import"./date-adb8c64a.js";import"./EmptyList-3026908b.js";import"./CustomColumn-97fca79e.js";const H=s=>(R("data-v-c28e222b"),s=s(),W(),s),J={key:1,class:"tab-body__container !tw-pt-0"},K={key:1,class:"tw-mt-2"},Q={class:"tw-sticky tw-left-0 tw-text-center tw-py-4"},X=H(()=>g("div",{class:"spinner tw-p-5 tw-mx-auto"},null,-1)),Y=[X],Z={class:"align-center"},f=20,tt=T({__name:"ContactTabsDeals",props:{contactId:{}},emits:["add-entity"],setup(s,{emit:_}){const k=s,D=["id","stage_id","name","states","create_datetime","amount","user","tags","last_action"],e=p({contact_id:k.contactId,fields:["last_action"],limit:f,offset:0,_:Date.now()}),i=p(0),a=p([]),{updateCounterByRouteName:C}=B(),{data:I,isFetching:v}=$(x(()=>`crm.deal.list?${O.stringify(e.value)}`),{immediate:!0,refetch:!0}).get().json();N(I,t=>{t&&(t.params.offset>0?a.value=[...a.value||[],...t.data]:a.value=t.data,i.value=t.params.total_count,e.value.offset=t.params.offset,C("contactDealsTab",i.value))}),A(F).on(()=>{e.value._=Date.now()});function S(){e.value.offset+f>=i.value||(e.value.offset+=f)}const d=E();return d.fetch(),(t,l)=>!o(d).funnelsMap||o(v)&&e.value.offset===0?(n(),M(G,{key:0,class:"tab-body__container","row-height":"130px"})):(n(),c("div",J,[t.$route.meta.menuItemType!=="frame"&&a.value.length?(n(),c("div",{key:0,class:"tw-sticky tw-py-1 tw-bg-waBlank tw-z-10",style:L({top:"calc(var(--header-height))"})},[m(b,{icon:"plus",onClick:l[0]||(l[0]=y(u=>_("add-entity","addDeal"),["prevent"]))},{default:r(()=>[h(w(t.$t("addDeal")),1)]),_:1})],4)):(n(),c("div",K)),m(q,{"tile-view":!0,deals:a.value,"funnels-map":o(d).funnelsMap,"use-columns-ids":D},P({lazy:r(()=>[V((n(),c("div",Q,Y)),[[z,a.value.length<i.value],[o(U),([{isIntersecting:u}])=>{u&&!o(v)&&S()}]])]),_:2},[t.$route.meta.isWidgetMode?void 0:{name:"bottomEmptyList",fn:r(()=>[g("div",Z,[m(b,{icon:"plus",onClick:l[1]||(l[1]=y(u=>_("add-entity","addDeal"),["prevent"]))},{default:r(()=>[h(w(t.$t("addDeal")),1)]),_:1})])]),key:"0"}]),1032,["deals","funnels-map"])]))}});const ht=j(tt,[["__scopeId","data-v-c28e222b"]]);export{ht as default};
